{"version":3,"sources":["game/data.ts","components/PlayerBuilder.tsx","hooks/useScroll.tsx","components/EncounterBuilder.tsx","components/menus/Menu.tsx","geneticalgorithm/geneticalgorithm.js","game/tinkerer.ts","components/Enemy.tsx","components/Player.tsx","components/Game.tsx","hooks/useForceRerender.tsx","hooks/usePressedKeys.tsx","components/menus/SingleGame.tsx","components/menus/LoadScreen.tsx","App.tsx","reportWebVitals.ts","index.tsx","game/effectRepository.ts","game/playGame.ts","game/zFunDump.ts","game/modding.ts","game/types.ts","stateMachines/menuStateMachine.ts","serviceWorkerRegistration.ts"],"names":["previousState","play","states","length","makeRange","number","Set","allRanges","selfRange","makeStat","amount","max","current","defaultStatus","dodge","active","armor","bleed","turns","stun","randomEnemy","Chance","pickone","enemies","dummyEnemy","globals","trainingEnemy","randomName","names","Math","floor","random","randomBuild","rng","buildOverride","debug","build","basic","class","skill","weapon","offhand","footwear","headgear","charm","consumable","playerStatsDefault","hp","stamina","staminaPerTurn","speed","attack","defence","status","randomPlayer","statsOverride","id","string","lore","name","age","weapons","display","tooltip","effects","effectFunCall","priority","range","target","passives","eot","rolls","distance","enemy","updateGlobals","systemBuildKeys","ElementPicker","isSelected","section","options","setField","scrollParams","elRef","useRef","scrollIntoView","useScroll","behavior","block","scrollTo","scrollRef","Row","Form","Label","ButtonGroup","size","className","map","item","Button","variant","onClick","ref","PlayerBuilder","onSave","player","playerStats","React","useState","form","setForm","setLore","displayType","type","postBuildPlayerStats","buildPlayer","onSubmit","e","preventDefault","Container","fluid","style","marginBottom","safeEntries","filter","has","values","value","field","Navbar","fixed","bg","maxHeight","Text","EncounterBuilder","encounter","setEncounter","a","enemiesStats","disabled","idx","found","m","_","Menu","title","Card","Title","state","geneticAlgorithmConstructor","settingWithDefaults","settings","defaults","mutationFunction","crossoverFunction","fitnessFunction","doesABeatBFunction","population","Error","populationSize","phenotype","b","undefined","cloneJSON","object","JSON","parse","stringify","mutate","crossover","mate","evolve","rand","push","populate","index","otherIndex","temp","randomizePopulationOrder","nextGeneration","p","competitor","compete","this","best","scored","scoredPopulation","reduce","score","bestScore","config","clone","defaultTinkererOptions","playerSeed","weights","monster","turn","findBestPlay","iter","optionsOverride","oldPlay","latestState","monsterHealth","acc","newPlay","d6","setSelected","natural","min","latest","actions","playerActions","inventory","unavailable","handlePlayerEffect","exclude","playerHealth","playerStamina","startPlayerHealth","startPlayerStamina","startMonsterHealth","monsterKillingFitness","playerAlivenessFitness","killSpeedFitness","staminaFitness","fitness","console","log","rangeArr","gen","GeneticAlgorithmConstructor","i","Seq","sortBy","toArray","EnemyCard","enemyStats","onSelect","latestAttack","canAct","hotkey","Body","countBy","v","find","OverlayTrigger","placement","delay","show","hide","overlay","Popover","Header","as","join","toFixed","toUpperCase","PlayerCard","selectedButtons","inventoryStats","onClickEffect","lastAction","disabledSkills","setDisabledSkills","k","bot","hasPassives","Subtitle","ToggleButton","checked","onChange","event","currentTarget","delete","add","Stack","direction","gap","clamp","monsterHotkeys","Game","game","solveGame","timeTravel","hint","onMenu","lastAttacks","isLogShown","setShowLog","forceUpdate","setValue","useForceRerender","useEffect","ingame","handleCloseLog","playerSkills","isPlayerAlive","areMonstersAlive","endGame","pressed","onUp","pressedKeys","updatePressedKeys","downHandler","key","set","upHandler","useCallback","window","addEventListener","removeEventListener","usePressedKeys","valNum","parseInt","save","undo","redo","flatMap","blob","Blob","saveAs","Date","now","Col","sm","md","Player","origin","phase","zip","stats","xs","Enemy","Modal","onHide","scrollable","centered","closeButton","s","Footer","SingleGame","onGameEnd","setGame","setRedo","gameState","playState","timeTravelObj","newRedo","pop","slice","iterations","maxBy","LoadScreen","onLoad","loadError","setLoadError","load","data","playRaw","fileData","files","reader","FileReader","onloadend","ev","result","readAsText","rawData","Alert","Group","Control","accept","muted","rows","placeholder","App","useMachine","gameMenuMachine","devTools","send","matches","Object","keys","main","on","quick","makeGameNew","context","singleContext","seed","single","training","arcade","survivalContext","arcadeContext","victories","otherEnemy","firstState","makeGameNextLevel","survival","lastState","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","container","document","getElementById","createRoot","render","StrictMode","serviceWorkerRegistration","effectFun","fun","params","oldState","applyPoison","currentState","pipe","changeStatPlayer","changeStatMonster","newState","addBotEffect","engineFunctions","_origin","changeStatusPlayer","o","changeStatusMonster","effectFunRepo","changeDistance","attackMonster","modifyPlayerStamina","gameTarget","attackPlayer","addEnemy","_m","updateMonster","override","updatePlayer","curr","damage","afterDefence","afterArmor","armorSpent","afterBleed","f","updateStatus","removeMonster","currPlay","currSnap","modify","updatePlayerStat","addEotEffect","effect","statsRepository","turnDeterministicRng","randPerTurn","monsterSeed","monsterChance","floating","used","playerPassives","playerGameStats","enemyGameStats","toIndexableString","version","reduceFuns","funs","dodgeable","priorityBonus","monsterId","targetMonster","isStunnedPlayer","isStunnedMonster","startState","parameters","callEffectFun","extractFunction","effectEotCleanup","effectDead","d","lastTurnState","usedSkill","initialState","preBotPlay","preBotState","postBotPlay","postBotState","entitiesBot","eff","postEntitiesBotPlay","postEntitiesBotState","turnRng","ceil","turnFunctions","roll","concat","entitiesEot","playerEotEffects","enemiesEotEffects","postPlayerEotPlay","postPlayerEotState","postEotPlay","postEotState","postCleanup","postCleanupState","scoreGame","hpLoss","staminaLoss","Array","num","Infinity","t","globalsDefault","globalThis","theThis","__buildmancer","isArray","repo","entries","isDebug","process","inspect","server","WebSocket","Server","port","toMenu","MENU","initial","entry","WIN","LOSE","win","lose","PLAYER","ENCOUNTER","cond","internal","victory","defeat","puzzle","SELECTED","COMPLETE","complete","NEXT","SELECT","LOAD","makeArcadeContext","makeSurvivalContext","makeSingleContext","createMachine","tsTypes","QUICK","SINGLE","TRAINING","ARCADE","SURVIVAL","guards","isFinal","bumpVictories","assign","_event","bumpScore","reset","c","interpret","onTransition","start","isLocalhost","Boolean","location","hostname","match","register","navigator","URL","href","swUrl","fetch","headers","response","contentType","get","indexOf","serviceWorker","ready","registration","unregister","reload","registerValidSW","catch","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","error"],"mappings":"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A,QACA,SACA,SACA,OACA,OACA,SACA,QACA,QACA,UACA,SACA,QACA,UACA,UACA,UACA,WACA,QACA,WACA,QACA,SACA,SACA,OACA,SACA,QACA,QACA,OACA,WACA,SACA,QACA,UACA,SACA,UACA,SACA,SACA,SACA,SACA,QACA,QACA,OACA,OACA,QACA,QACA,WACA,QACA,UACA,SACA,UACA,QACA,OACA,OACA,OACA,SACA,WACA,OACA,OACA,QACA,MACA,SACA,OACA,UACA,QACA,UACA,SACA,MACA,UACA,QACA,SACA,QACA,SACA,QACA,QACA,QACA,QACA,SACA,QACA,QACA,SACA,QACA,OACA,QACA,SACA,SACA,UACA,QACA,QACA,QACA,OACA,QACA,OACA,QACA,SACA,SACA,QACA,QACA,QACA,QACA,QACA,UACA,UACA,QACA,QACA,QACA,UACA,SACA,QACA,SACA,UACA,SACA,QACA,OACA,SACA,QACA,OACA,UACA,QACA,SACA,UACA,SACA,MACA,QACA,OACA,MACA,QACA,YACA,OACA,QACA,QACA,SACA,QACA,QACA,SACA,QACA,SACA,UACA,UAGF8C,YAAc,CAAEtC,QAAOb,a,0NCtoCjBoD,EAAoCrE,YAAI,CAAC,QAAS,UAuDlDsE,EAAgB,SAAC,GAEhB,IAFkBC,EAEnB,EAFmBA,WAAYC,EAE/B,EAF+BA,QAASC,EAExC,EAFwCA,QAASC,EAEjD,EAFiDA,SAGrD,EC/Da,SAAsCC,GACnD,IAAMC,EAAQC,iBAAU,MAGxB,MAAO,CAFe,kBAAMD,EAAMtE,QAASwE,eAAeH,IAEnCC,GD2DOG,CAAU,CACtCC,SAAU,SACVC,MAAO,UAFT,mBAAOC,EAAP,KAAiBC,EAAjB,KAKA,OACE,eAACC,EAAA,EAAD,WACE,cAACC,EAAA,EAAKC,MAAN,UAAad,IACb,uBACA,cAACe,EAAA,EAAD,CAAaC,KAAK,KAAKC,UAAU,OAAjC,SACGhB,EAAQiB,KAAI,SAACC,GAAD,OACX,cAACC,EAAA,EAAD,CAEEvC,KAAMmB,EACNtB,GAAE,UAAKyC,EAAKnC,SACZqC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","file":"static/js/main.5dd17c22.chunk.js","sourcesContent":["import { Chance } from \"chance\";\nimport { Subtract } from \"type-fest/source/internal\";\nimport { globals, updateGlobals } from \"./modding\";\nimport { Build, Distances, Enemy, EnemyStats, Item, Player, PlayerStats, Ranges, Snapshot, UpTo, Play, effectFunCall, Stat, Status, BuildRepository, EnemyRepository, EnemyInfo } from \"./types\";\n\n\nexport const startState = (play: Play): Snapshot => play.states[0];\nexport const previousState = (play: Play): Snapshot => play.states[play.states.length - 1];\n\nexport const makeRange = (...number: UpTo<Subtract<Distances, 1>>[]) => [...new Set(number)] as Ranges;\nexport const allRanges = makeRange(0, 1, 2, 3, 4);\nexport const selfRange = allRanges;\n\nexport const makeStat = (amount: number, max: number = amount): Stat => ({ current: amount, max });\nexport const defaultStatus: Status = {\n  dodge: { active: false },\n  armor: { amount: 0 },\n  bleed: { turns: 0 },\n  stun: { active: false },\n}\n\nexport const randomEnemy = (): EnemyInfo => new Chance().pickone(enemies);\nexport const dummyEnemy = (): EnemyInfo => globals().trainingEnemy;\n\nexport const randomName = () => names[Math.floor(Math.random() * names.length)];\n\nexport const randomBuild = (rng: Chance.Chance, buildOverride?: Partial<Build>) => ({\n  debug: build.debug[globals().debug ? 1 : 0],\n  basic: rng.pickone(build.basic),\n  class: rng.pickone(build.class),\n  skill: rng.pickone(build.skill),\n  armor: rng.pickone(build.armor),\n  weapon: rng.pickone(build.weapon),\n  offhand: rng.pickone(build.offhand),\n  footwear: rng.pickone(build.footwear),\n  headgear: rng.pickone(build.headgear),\n  charm: rng.pickone(build.charm),\n  consumable: rng.pickone(build.consumable),\n  ...buildOverride,\n});\n\nexport const playerStatsDefault: PlayerStats = {\n  hp: makeStat(10),\n  stamina: makeStat(6),\n  staminaPerTurn: makeStat(2),\n  speed: makeStat(0),\n  attack: makeStat(0),\n  defence: makeStat(0),\n  status: defaultStatus,\n};\n\nexport const randomPlayer = (statsOverride?: PlayerStats, buildOverride?: Partial<Build>): [Player, PlayerStats] => {\n  const rng = new Chance();\n  return [{\n    id: rng.string(),\n    lore: {\n      name: randomName(),\n      age: rng.age(),\n    },\n    build: randomBuild(rng, buildOverride)\n  }, {\n    ...playerStatsDefault,\n    ...statsOverride,\n  }];\n}\n\nconst weapons: Item[] = [\n  {\n    display: \"Sword\",\n    tooltip: \"All-rounder\",\n    effects: [\n      {\n        display: \"Slash\",\n        tooltip: \"Swings at the enemy\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 2 }])\n        ],\n        priority: 3,\n        stamina: 2,\n        range: makeRange(0, 1),\n      },\n      {\n        display: \"Pommel Hit\",\n        tooltip: \"Deals a quick blow\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 2 }])\n        ],\n        priority: 2,\n        stamina: 2,\n        range: makeRange(0),\n      },\n      {\n        display: \"Overhead Slice\",\n        tooltip: \"Moves into melee and deals a heavy blow\",\n        effects: [\n          effectFunCall([\"Basic:Move\", { amount: -1 }]), effectFunCall([\"Basic:Attack\", { amount: 4 }])\n        ],\n        priority: 4,\n        stamina: 3,\n        range: makeRange(1),\n      },\n    ],\n  },\n  {\n    display: \"Greatsword\",\n    tooltip: \"Specialized in big damage\",\n    effects: [\n      {\n        display: \"Rend\",\n        tooltip: \"Swings at the enemy\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 3 }])\n        ],\n        priority: 4,\n        stamina: 4,\n        range: makeRange(0, 1),\n      },\n      {\n        display: \"Feint\",\n        tooltip: \"Quick step backwards\",\n        effects: [\n          effectFunCall([\"Basic:Move\", { amount: 1 }])\n        ],\n        priority: 1,\n        stamina: 1,\n        range: makeRange(0, 1),\n      },\n      {\n        display: \"Earth Flattener\",\n        tooltip: \"Charges a monstruous stunning blow\",\n        effects: [\n          effectFunCall([\"Basic:Move\", { amount: 5 }]), effectFunCall(\"Effect:Stun\")\n        ],\n        priority: 4,\n        stamina: 6,\n        range: makeRange(1),\n      },\n    ],\n  },\n  {\n    display: \"Twinblades\",\n    tooltip: \"Specialized in mobility\",\n    effects: [\n      {\n        display: \"Swoosh\",\n        tooltip: \"Deals a strike and moves back\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 2 }]),\n          effectFunCall([\"Basic:Move\", { amount: 1 }])\n        ],\n        priority: 2,\n        stamina: 2,\n        range: makeRange(0, 1),\n      },\n      {\n        display: \"Fiuuum\",\n        tooltip: \"Jump attack\",\n        effects: [\n          effectFunCall([\"Basic:Move\", { amount: -2 }]),\n          effectFunCall([\"Basic:Attack\", { amount: 3 }])\n        ],\n        priority: 4,\n        stamina: 3,\n        range: makeRange(2, 3),\n      },\n      {\n        display: \"SwishSwishSwishSwish\",\n        tooltip: \"Deals multiple low damage hits\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n          effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n          effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n          effectFunCall([\"Basic:Attack\", { amount: 1 }])\n        ],\n        priority: 3,\n        stamina: 4,\n        range: makeRange(0),\n      },\n    ],\n  },\n  {\n    display: \"Katana\",\n    tooltip: \"Specialized in bleeding\",\n    effects: [\n      {\n        display: \"Slice & Dice\",\n        tooltip: \"Deals two swift strikes\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n          effectFunCall([\"Basic:Attack\", { amount: 1 }])],\n        priority: 3,\n        stamina: 2,\n        range: makeRange(0, 1),\n      },\n      {\n        display: \"Wakizashi\",\n        tooltip: \"Short sword with a quick attack causing bleeding\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n          effectFunCall([\"Effect:Bleed\", { target: 'Monster', turns: 2 }])\n        ],\n        priority: 2,\n        stamina: 4,\n        range: makeRange(0, 1),\n      },\n      {\n        display: \"Unsheathe\",\n        tooltip: \"Dodges the next attack and deals damage\",\n        effects: [\n          effectFunCall('Effect:Dodge'),\n          effectFunCall([\"Basic:Attack\", { amount: 3 }])\n        ],\n        priority: 1,\n        stamina: 4,\n        range: makeRange(0),\n      },\n    ],\n  },\n  {\n    display: \"Axe\",\n    tooltip: \"Specialized in debuffs\",\n    effects: [\n      {\n        display: \"Chop\",\n        tooltip: \"A slow but reliable attack\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 2 }])\n        ],\n        priority: 4,\n        stamina: 3,\n        range: makeRange(0, 1),\n      },\n      {\n        display: \"Aim for the head!\",\n        tooltip: \"Cripples the monster\",\n        effects: [\n          effectFunCall([\"Effect:Defence\", { target: 'Monster', amount: -1 }]),\n          effectFunCall([\"Effect:Bleed\", { target: 'Player', turns: 3 }])\n        ],\n        priority: 4,\n        stamina: 5,\n        range: makeRange(1),\n      },\n      {\n        display: \"Target the limbs!\",\n        tooltip: \"Weakens the monster\",\n        effects: [\n          effectFunCall([\"Effect:Attack\", { target: 'Monster', amount: -1 }]),\n          effectFunCall([\"Effect:Bleed\", { target: 'Player', turns: 3 }])\n        ],\n        priority: 4,\n        stamina: 5,\n        range: makeRange(1),\n      },\n    ],\n  },\n  {\n    display: \"Lance\",\n    tooltip: \"Specialized in mid-range attacks\",\n    effects: [\n      {\n        display: \"Pierce\",\n        tooltip: \"Pokes the enemy\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 2 }])\n        ],\n        priority: 3,\n        stamina: 2,\n        range: makeRange(0, 1, 2),\n      },\n      {\n        display: \"Charge!!\",\n        tooltip: \"Runs towards the enemy to deal a massive blow\",\n        effects: [\n          effectFunCall([\"Basic:Move\", { amount: -5 }]), effectFunCall([\"Basic:Attack\", { amount: 4 }])\n        ],\n        priority: 1,\n        stamina: 3,\n        range: makeRange(4),\n      },\n    ],\n  },\n  {\n    display: \"Hammer\",\n    tooltip: \"Specialized in stunning\",\n    effects: [\n      {\n        display: \"Head Banger\",\n        tooltip: \"Hits the enemy in the head\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 2 }]),\n          effectFunCall(\"Effect:Stun\")\n        ],\n        priority: 4,\n        stamina: 4,\n        range: makeRange(0),\n      },\n      {\n        display: \"Large swing\",\n        tooltip: \"Uses the inertia of the hammer to safely advance\",\n        effects: [\n          effectFunCall([\"Basic:Move\", { amount: -3 }]),\n          effectFunCall(\"Effect:Stun\")\n        ],\n        priority: 3,\n        stamina: 3,\n        range: makeRange(1, 2, 3),\n      },\n      {\n        display: \"Go for the ankles\",\n        tooltip: \"Slows down the enemy\",\n        effects: [\n          effectFunCall([\"Effect:Speed\", { target: 'Monster', amount: -1 }]),\n          effectFunCall(\"Effect:Stun\"),\n        ],\n        priority: 4,\n        stamina: 6,\n        range: makeRange(1),\n      },\n    ],\n  },\n  {\n    display: \"Finger Claw\",\n    tooltip: \"Specialized in poison\",\n    effects: [\n      {\n        display: \"Caress\",\n        tooltip: \"Applies poison to the monster\",\n        effects: [\n          effectFunCall([\"Effect:Poison\", { target: 'Monster', turns: 2 }])\n        ],\n        priority: 3,\n        stamina: 2,\n        range: makeRange(0),\n      },\n      {\n        display: \"Backflip\",\n        tooltip: \"Dodges an attack and moves backward\",\n        effects: [\n          effectFunCall(\"Effect:Dodge\"),\n          effectFunCall([\"Basic:Move\", { amount: 2 }]),\n        ],\n        priority: 1,\n        stamina: 4,\n        range: makeRange(0, 1),\n      },\n    ],\n  },\n  {\n    display: \"Bow\",\n    tooltip: \"Specialized in ranged attacks\",\n    effects: [\n      {\n        display: \"Relaxed Shot\",\n        tooltip: \"Shoots an arrow\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 2 }])\n        ],\n        priority: 3,\n        stamina: 2,\n        range: makeRange(3, 4),\n      },\n      {\n        display: \"Power Draw\",\n        tooltip: \"Shoots your strongest arrow and makes you weaker\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 6 }]),\n          effectFunCall([\"Effect:Attack\", { target: 'Player', amount: -1 }]),\n        ],\n        priority: 3,\n        stamina: 4,\n        range: makeRange(4),\n      },\n    ],\n  },\n  {\n    display: \"Magic Staff\",\n    tooltip: \"Specialized in multiple attacks\",\n    effects: [\n      {\n        display: \"Bolt\",\n        tooltip: \"Shoots a low damage bolt\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 1 }])\n        ],\n        priority: 3,\n        stamina: 3,\n        range: allRanges,\n      },\n      {\n        display: \"Pew Pew Pew\",\n        tooltip: \"Shoots a barrage of bolts\",\n        effects: [\n          effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n          effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n          effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n          effectFunCall([\"Basic:Attack\", { amount: 1 }])],\n        priority: 4,\n        stamina: 8,\n        range: makeRange(2, 3, 4),\n      },\n    ],\n  },\n];\n\nexport const build: BuildRepository = {\n  debug: [\n    {\n      display: \"None\",\n    },\n    {\n      display: \"Debug\",\n      effects: [\n        {\n          display: \"GGWP\",\n          tooltip: \"Wins the game\",\n          priority: 1,\n          stamina: 0,\n          range: allRanges,\n          effects: [effectFunCall('Debug:GGWP')]\n        },\n        {\n          display: \"SUDOKU\",\n          tooltip: \"Loses the game\",\n          priority: 1,\n          stamina: 0,\n          range: allRanges,\n          effects: [effectFunCall('Debug:Sudoku')]\n        },\n      ]\n    }\n  ],\n  basic: [\n    {\n      display: \"Basic\",\n      effects: [\n        {\n          display: \"Rest\",\n          tooltip: \"Skip the turn and restore stamina\",\n          priority: 4,\n          stamina: 0,\n          range: selfRange,\n          effects: [effectFunCall('Basic:Rest')]\n        },\n        {\n          display: \"Advance\",\n          tooltip: \"Move closer\",\n          priority: 4,\n          stamina: 1,\n          range: selfRange,\n          effects: [effectFunCall(['Basic:Move', { amount: -1 }])]\n        },\n        {\n          display: \"Retreat\",\n          tooltip: \"Move farther\",\n          effects: [effectFunCall([\"Basic:Move\", { amount: 1 }])],\n          priority: 4,\n          stamina: 1,\n          range: selfRange,\n        }\n      ]\n    }\n  ],\n  class: [\n    {\n      display: \"Warrior\",\n      passives: [\"+Attack\", \"+Defence\", \"+Stamina\"],\n      effects: [\n        {\n          display: \"Well placed kick\",\n          tooltip: \"Last resource attack\",\n          effects: [effectFunCall([\"Basic:Attack\", { amount: 2 }])],\n          priority: 2,\n          stamina: 1,\n          range: makeRange(0, 1),\n        }\n      ]\n    },\n    {\n      display: \"Rogue\",\n      passives: [\"+Speed\", \"+Speed\", \"-Attack\", \"-Stamina\"],\n      effects: [\n        {\n          display: \"Strategic Retreat\",\n          tooltip: \"Jump backwards\",\n          effects: [effectFunCall([\"Basic:Move\", { amount: 999 }])],\n          priority: 2,\n          stamina: 1,\n          range: selfRange,\n        }\n      ]\n    },\n    {\n      display: \"Berserk\",\n      passives: [\"+Attack\", \"+Attack\", \"+Attack\", \"-Defence\", \"-Defence\", \"-Health\"],\n      effects: [\n        {\n          display: \"All or Nothing!\",\n          tooltip: \"Deals massive damage and leaves you weakened\",\n          priority: 2,\n          stamina: 0,\n          range: makeRange(0, 1, 2),\n          amount: 1,\n          effects: [\n            effectFunCall(['Basic:Move', { amount: -5 }]),\n            effectFunCall(['Basic:Attack', { amount: 2 }]),\n            effectFunCall(['Basic:Attack', { amount: 2 }]),\n            effectFunCall(['Basic:Attack', { amount: 2 }]),\n            effectFunCall(['Basic:Attack', { amount: 2 }]),\n            effectFunCall(['Effect:Defence', { target: 'Player', amount: -3 }]),\n            effectFunCall(['Effect:Speed', { target: 'Player', amount: -1 }]),\n          ]\n        },\n      ]\n    },\n    {\n      display: \"Mage\",\n      passives: [\"+StaPerTurn\", \"+Stamina\", \"-Health\", \"-Speed\"],\n      effects: [\n        {\n          display: \"Just having a thought\",\n          tooltip: \"Restores stamina for the next action\",\n          priority: 4,\n          amount: 2,\n          stamina: 0,\n          range: selfRange,\n          effects: [\n            effectFunCall(['Basic:Stamina', { amount: 999 }]),\n          ]\n        },\n      ]\n    },\n    {\n      display: \"Cleric\",\n      passives: [\"+Defence\", \"+Stamina\"],\n      effects: [\n        {\n          display: \"Minor Healing\",\n          tooltip: \"Restores some HP\",\n          amount: 3,\n          effects: [\n            effectFunCall([\"Basic:HP\", { amount: 5 }]),\n          ],\n          priority: 3,\n          stamina: 3,\n          range: selfRange,\n        }\n      ]\n    },\n  ],\n  skill: [\n    {\n      display: \"Sturdy\",\n      effects: [\n        {\n          display: \"Endure the pain\",\n          tooltip: \"Blocks some damage\",\n          effects: [effectFunCall([\"Effect:Armor\", { amount: 2 }])],\n          priority: 1,\n          stamina: 2,\n          range: selfRange,\n        },\n      ]\n    },\n    {\n      display: \"Nimble\",\n      effects: [\n        {\n          display: \"Dodge\",\n          tooltip: \"Avoid one enemy attack\",\n          effects: [effectFunCall(\"Effect:Dodge\")],\n          priority: 2,\n          stamina: 4,\n          range: selfRange,\n        }\n      ]\n    },\n    {\n      display: \"Resourceful\",\n      effects: [\n        {\n          display: \"Dodge this!\",\n          tooltip: \"Throws a stone\",\n          effects: [effectFunCall([\"Basic:Attack\", { amount: 2 }])],\n          priority: 3,\n          stamina: 3,\n          range: makeRange(3, 4),\n        }\n      ]\n    },\n  ],\n  weapon: weapons,\n  offhand: [\n    {\n      display: \"Hook\",\n      passives: [\"-Stamina\"],\n      effects: [\n        {\n          display: \"Get over here!\",\n          tooltip: \"Moves enemy closer\",\n          effects: [effectFunCall([\"Basic:Attack\", { amount: 3 }]), effectFunCall([\"Basic:Move\", { amount: -2 }])],\n          priority: 4,\n          stamina: 3,\n          range: makeRange(2, 3, 4),\n        },\n      ],\n    },\n    {\n      display: \"Parry Dagger\",\n      passives: [\"-Defence\"],\n      effects: [\n        {\n          display: \"Get over here!\",\n          tooltip: \"Avoids a melee attack\",\n          effects: [effectFunCall(\"Effect:Dodge\")],\n          priority: 2,\n          stamina: 2,\n          range: makeRange(1),\n        },\n      ],\n    },\n    {\n      display: \"Shield\",\n      passives: [\"+Defence\", \"-Speed\"],\n      effects: [\n        {\n          display: \"Not today!\",\n          tooltip: \"Blocks a lot of damage\",\n          effects: [effectFunCall([\"Effect:Armor\", { amount: 5 }])],\n          priority: 2,\n          stamina: 4,\n          range: selfRange,\n        },\n      ],\n    },\n    {\n      display: \"Focus\",\n      passives: [\"+Speed\", \"+StaPerTurn\"]\n    },\n    {\n      display: \"Wand\",\n      passives: [\"-Defence\", \"-StaPerTurn\"],\n      effects: [\n        {\n          display: \"Magic Bolt\",\n          tooltip: \"Shoots mana bolts until the caster faints\",\n          effects: [effectFunCall(\"Wand:MagicBolt\")],\n          priority: 3,\n          stamina: 1,\n          range: makeRange(3, 4),\n        }\n      ]\n    },\n  ],\n  armor: [\n    {\n      display: \"Heavy\",\n      passives: [\"+Defence\", \"+Defence\", \"+Defence\", \"+Defence\", \"-Speed\", \"-Speed\", \"-StaPerTurn\"],\n    },\n    {\n      display: \"Medium\",\n      passives: [\"+Defence\", \"+Defence\", \"-StaPerTurn\"],\n    },\n    {\n      display: \"Light\",\n      passives: [\"+Defence\"],\n    },\n    {\n      display: \"None\",\n      passives: [\"+Speed\"],\n    },\n  ],\n  headgear: [\n    {\n      display: \"Helm\",\n      passives: [\"+Defence\", \"+Defence\", \"-Speed\", \"-StaPerTurn\"],\n      tooltip: \"Big protection for slow combatants\",\n    },\n    {\n      display: \"Feather Cap\",\n      passives: [\"+StaPerTurn\", \"+Stamina\"],\n      tooltip: \"Makes you feel energized, doesn't it?\",\n    },\n    {\n      display: \"Mage Hat\",\n      passives: [\"-StaPerTurn\"],\n      tooltip: \"Small tricks for big plays\",\n      effects: [\n        {\n          display: \"Flash!\",\n          tooltip: \"Blinks you to a better position\",\n          effects: [\n            effectFunCall([\"Basic:Attack\", { amount: 1 }]),\n            effectFunCall([\"Basic:Move\", { amount: 2 }])\n          ],\n          priority: 3,\n          stamina: 4,\n          range: makeRange(1, 2),\n        }\n      ]\n    },\n  ],\n  footwear: [\n    {\n      display: \"Slippers of Dooooodge!\",\n      tooltip: \"Allows you to dodge attacks\",\n      passives: [\"-Stamina\"],\n      effects: [\n        {\n          display: \"Advanced Dodge\",\n          tooltip: \"Avoid 1 attack\",\n          effects: [effectFunCall(\"Effect:Dodge\")],\n          priority: 1,\n          stamina: 3,\n          range: selfRange,\n        },\n      ],\n    },\n    {\n      display: \"Boots of Flight\",\n      tooltip: \"Avoid your enemies\",\n      passives: [\"-StaPerTurn\", \"-Defence\"],\n      eot: [{\n        display: \"Flight!\",\n        tooltip: \"Increases distance every turn\",\n        priority: 0,\n        range: allRanges,\n        effects: [effectFunCall('BootsOfFlight:EOT')],\n      }],\n    },\n    {\n      display: \"Greaves of Stability\",\n      tooltip: \"Extra resilient\",\n      passives: [\"+Defence\", \"-Speed\"],\n      effects: [\n        {\n          display: \"Dig your heels\",\n          tooltip: \"Resists damage\",\n          effects: [effectFunCall([\"Effect:Armor\", { amount: 3 }])],\n          priority: 1,\n          stamina: 4,\n          range: selfRange,\n        },\n      ],\n    },\n  ],\n  charm: [\n    {\n      display: \"of Health\",\n      passives: [\"+Health\", \"-Speed\"],\n      tooltip: \"Increases your maximum health\",\n    },\n    {\n      display: \"of Haste\",\n      passives: [\"+StaPerTurn\", \"-Stamina\"],\n      tooltip: \"Increases your maximum stamina regeneration\",\n    },\n    {\n      display: \"of Resilience\",\n      passives: [\"+Stamina\", \"-StaPerTurn\"],\n      tooltip: \"Increases your maximum stamina\",\n    },\n    {\n      display: \"of Strength\",\n      passives: [\"+Attack\", \"-Health\", \"-StaPerTurn\"],\n      tooltip: \"Increases your maximum attack\",\n    },\n    {\n      display: \"of Swiftness\",\n      passives: [\"+Speed\", \"-Attack\"],\n      tooltip: \"Increases your maximum speed\",\n    },\n    {\n      display: \"of Defence\",\n      passives: [\"+Defence\", \"-Stamina\", \"-Speed\"],\n      tooltip: \"Increases your maximum defence\",\n    },\n  ],\n  consumable: [\n    {\n      display: \"Healing Potion\",\n      effects: [\n        {\n          display: \"Healing!\",\n          tooltip: \"Restores some HP\",\n          effects: [\n            effectFunCall([\"Basic:HP\", { amount: 4 }]),\n          ],\n          priority: 4,\n          stamina: 5,\n          amount: 3,\n          range: selfRange,\n        }\n      ]\n    },\n    {\n      display: \"Pot of Razors\",\n      effects: [\n        {\n          display: \"Throw pot\",\n          tooltip: \"Causes bleeding\",\n          amount: 2,\n          effects: [\n            effectFunCall([\"Effect:Bleed\", { target: 'Monster', turns: 3 }]),\n          ],\n          priority: 4,\n          stamina: 5,\n          range: selfRange,\n        }\n      ]\n    },\n    {\n      display: \"Life Bubble\",\n      effects: [\n        {\n          display: \"Activate Bubble\",\n          tooltip: \"Protects against a single source of damage this turn\",\n          effects: [\n            effectFunCall(\"Effect:Dodge\"),\n          ],\n          priority: 1,\n          stamina: 1,\n          amount: 1,\n          range: selfRange,\n        }\n      ]\n    },\n    {\n      display: \"Pet Rock\",\n      effects: [\n        {\n          display: \"Rock, to me!\",\n          tooltip: \"Reduces damage\",\n          effects: [\n            effectFunCall([\"Effect:Armor\", { amount: 3 }]),\n          ],\n          priority: 2,\n          stamina: 3,\n          amount: 3,\n          range: selfRange,\n        }\n      ]\n    },\n  ],\n};\n\nexport const enemies: EnemyRepository = [\n  [{\n    lore: {\n      name: \"Sacapuntas\",\n    },\n    rolls: [\n      [0, 1, 2, 1, 0],\n      [0, 1, 0, 0, 0],\n      [0, 0, 0, 0, 0],\n      [0, 0, 0, 0, 0],\n      [0, 1, 2, 1, 0, 0],\n    ],\n    effects: [\n      { display: \"Swipe\", tooltip: \"Swipe\", priority: 3, effects: [effectFunCall([\"Monster:Attack\", { amount: 3 }])], range: makeRange(0, 1) },\n      { display: \"Roar\", tooltip: \"Roar\", priority: 1, effects: [effectFunCall([\"Basic:Stamina\", { amount: -5 }])], range: allRanges },\n      { display: \"Jump\", tooltip: \"Jump\", priority: 2, effects: [effectFunCall([\"Monster:Move\", { amount: -4 }])], range: makeRange(2, 3, 4) },\n    ],\n  }, {\n    hp: makeStat(25),\n    distance: 4,\n    speed: makeStat(0),\n    attack: makeStat(0),\n    defence: makeStat(0),\n    status: defaultStatus,\n  }],\n  [{\n    lore: {\n      name: \"Toro\",\n    },\n    effects: [\n      { display: \"Swipe\", tooltip: \"Swipe\", priority: 3, effects: [effectFunCall([\"Monster:Attack\", { amount: 3 }])], range: allRanges },\n      { display: \"Jump\", tooltip: \"Jump\", priority: 2, effects: [effectFunCall([\"Monster:Move\", { amount: -4 }])], range: makeRange(2, 3, 4) },\n    ],\n    rolls: [\n      [0, 0, 0, 0, 0],\n      [0, 0, 0, 0, 0],\n      [1, 1, 0, 0, 0],\n      [1, 1, 1, 0, 0],\n      [1, 1, 1, 1, 0],\n    ]\n  }, {\n    hp: makeStat(22),\n    distance: 4,\n    speed: makeStat(0),\n    attack: makeStat(0),\n    defence: makeStat(0),\n    status: defaultStatus,\n  }],\n  [{\n    lore: {\n      name: \"Summoner\",\n    },\n    effects: [\n      { display: \"Swipe\", tooltip: \"Swipe\", priority: 3, effects: [effectFunCall([\"Monster:Attack\", { amount: 3 }])], range: makeRange(0, 1) },\n      { display: \"Retreat\", tooltip: \"Jump\", priority: 3, effects: [effectFunCall([\"Monster:Move\", { amount: 5 }])], range: allRanges },\n      { display: \"Summon Smol\", tooltip: \"Summon Smol\", priority: 4, effects: [effectFunCall([\"Monster:Summon\", { enemy: 4 }])], range: makeRange(2, 3, 4) },\n      { display: \"Spit\", tooltip: \"Ranged attack\", priority: 4, effects: [effectFunCall([\"Monster:Attack\", { amount: 2 }])], range: makeRange(2, 3, 4) },\n    ],\n    rolls: [\n      [1, 1, 1, 0, 0],\n      [1, 1, 1, 0, 0],\n      [1, 1, 3, 3, 0],\n      [2, 3, 3, 3, 0],\n      [2, 2, 3, 3, 0],\n    ]\n  }, {\n    hp: makeStat(30),\n    distance: 4,\n    speed: makeStat(0),\n    attack: makeStat(0),\n    defence: makeStat(0),\n    status: defaultStatus,\n  }],\n  [{\n    lore: {\n      name: \"Body\",\n    },\n    effects: [\n      { display: \"Swipe\", tooltip: \"Swipe\", priority: 3, effects: [effectFunCall([\"Monster:Attack\", { amount: 3 }])], range: makeRange() },\n    ],\n    rolls: [\n      [0],\n      [0],\n      [0],\n      [0],\n      [0],\n    ]\n  }, {\n    hp: makeStat(300),\n    distance: 0,\n    speed: makeStat(0),\n    attack: makeStat(0),\n    defence: makeStat(0),\n    status: defaultStatus,\n  }],\n\n  [{\n    lore: {\n      name: \"Smol\",\n    },\n    effects: [\n      { display: \"Swipe\", tooltip: \"Swipe\", priority: 3, effects: [effectFunCall([\"Monster:Attack\", { amount: 3 }])], range: makeRange() },\n    ],\n    rolls: [\n      [0],\n      [0],\n      [0],\n      [0],\n      [0],\n    ]\n  }, {\n    hp: makeStat(5),\n    distance: 0,\n    speed: makeStat(0),\n    attack: makeStat(0),\n    defence: makeStat(0),\n    status: defaultStatus,\n  }],\n];\n\nconst names = [\n  \"Lydan\",\n  \"Syrin\",\n  \"Ptorik\",\n  \"Joz\",\n  \"Varog\",\n  \"Gethrod\",\n  \"Hezra\",\n  \"Feron\",\n  \"Ophni\",\n  \"Colborn\",\n  \"Fintis\",\n  \"Gatlin\",\n  \"Jinto\",\n  \"Hagalbar\",\n  \"Krinn\",\n  \"Lenox\",\n  \"Revvyn\",\n  \"Hodus\",\n  \"Dimian\",\n  \"Paskel\",\n  \"Kontas\",\n  \"Weston\",\n  \"Azamarr\",\n  \"Jather\",\n  \"Tekren\",\n  \"Jareth\",\n  \"Adon\",\n  \"Zaden\",\n  \"Eune\",\n  \"Graff\",\n  \"Tez\",\n  \"Jessop\",\n  \"Gunnar\",\n  \"Pike\",\n  \"Domnhar\",\n  \"Baske\",\n  \"Jerrick\",\n  \"Mavrek\",\n  \"Riordan\",\n  \"Wulfe\",\n  \"Straus\",\n  \"Tyvrik\",\n  \"Henndar\",\n  \"Favroe\",\n  \"Whit\",\n  \"Jaris\",\n  \"Renham\",\n  \"Kagran\",\n  \"Lassrin\",\n  \"Vadim\",\n  \"Arlo\",\n  \"Quintis\",\n  \"Vale\",\n  \"Caelan\",\n  \"Yorjan\",\n  \"Khron\",\n  \"Ishmael\",\n  \"Jakrin\",\n  \"Fangar\",\n  \"Roux\",\n  \"Baxar\",\n  \"Hawke\",\n  \"Gatlen\",\n  \"Barak\",\n  \"Nazim\",\n  \"Kadric\",\n  \"Paquin\",\n  \"Kent\",\n  \"Moki\",\n  \"Rankar\",\n  \"Lothe\",\n  \"Ryven\",\n  \"Clawsen\",\n  \"Pakker\",\n  \"Embre\",\n  \"Cassian\",\n  \"Verssek\",\n  \"Dagfinn\",\n  \"Ebraheim\",\n  \"Nesso\",\n  \"Eldermar\",\n  \"Rivik\",\n  \"Rourke\",\n  \"Barton\",\n  \"Hemm\",\n  \"Sarkin\",\n  \"Blaiz\",\n  \"Talon\",\n  \"Agro\",\n  \"Zagaroth\",\n  \"Turrek\",\n  \"Esdel\",\n  \"Lustros\",\n  \"Zenner\",\n  \"Baashar\",\n  \"Dagrod\",\n  \"Gentar\",\n  \"Feston\",\n  \"Syrana\",\n  \"Resha\",\n  \"Varin\",\n  \"Wren\",\n  \"Yuni\",\n  \"Talis\",\n  \"Kessa\",\n  \"Magaltie\",\n  \"Aeris\",\n  \"Desmina\",\n  \"Krynna\",\n  \"Asralyn\",\n  \"Herra\",\n  \"Pret\",\n  \"Kory\",\n  \"Afia\",\n  \"Tessel\",\n  \"Rhiannon\",\n  \"Zara\",\n  \"Jesi\",\n  \"Belen\",\n  \"Rei\",\n  \"Ciscra\",\n  \"Temy\",\n  \"Renalee\",\n  \"Estyn\",\n  \"Maarika\",\n  \"Lynorr\",\n  \"Tiv\",\n  \"Annihya\",\n  \"Semet\",\n  \"Tamrin\",\n  \"Antia\",\n  \"Reslyn\",\n  \"Basak\",\n  \"Vixra\",\n  \"Pekka\",\n  \"Xavia\",\n  \"Beatha\",\n  \"Yarri\",\n  \"Liris\",\n  \"Sonali\",\n  \"Razra\",\n  \"Soko\",\n  \"Maeve\",\n  \"Everen\",\n  \"Yelina\",\n  \"Morwena\",\n  \"Hagar\",\n  \"Palra\",\n  \"Elysa\",\n  \"Sage\",\n  \"Ketra\",\n  \"Lynx\",\n  \"Agama\",\n  \"Thesra\",\n  \"Tezani\",\n  \"Ralia\",\n  \"Esmee\",\n  \"Heron\",\n  \"Naima\",\n  \"Rydna\",\n  \"Sparrow\",\n  \"Baakshi\",\n  \"Ibera\",\n  \"Phlox\",\n  \"Dessa\",\n  \"Braithe\",\n  \"Taewen\",\n  \"Larke\",\n  \"Silene\",\n  \"Phressa\",\n  \"Esther\",\n  \"Anika\",\n  \"Rasy\",\n  \"Harper\",\n  \"Indie\",\n  \"Vita\",\n  \"Drusila\",\n  \"Minha\",\n  \"Surane\",\n  \"Lassona\",\n  \"Merula\",\n  \"Kye\",\n  \"Jonna\",\n  \"Lyla\",\n  \"Zet\",\n  \"Orett\",\n  \"Naphtalia\",\n  \"Turi\",\n  \"Rhays\",\n  \"Shike\",\n  \"Hartie\",\n  \"Beela\",\n  \"Leska\",\n  \"Vemery\",\n  \"Lunex\",\n  \"Fidess\",\n  \"Tisette\",\n  \"Partha\",\n]\n\nupdateGlobals({ build, enemies });\n","import React from \"react\";\nimport { Container, Row, Form, Button, ButtonGroup, Navbar } from \"react-bootstrap\";\nimport useScroll from \"../hooks/useScroll\";\n\nimport { Build, Item, Player, PlayerStats, safeEntries } from \"../game/types\";\nimport { build, randomEnemy, randomName, randomPlayer } from \"../game/data\";\nimport { Set } from 'immutable';\nimport { buildPlayer } from \"../game/playGame\";\n\nconst systemBuildKeys: Set<keyof Build> = Set(['debug', 'basic']);\n\nconst PlayerBuilder = ({ onSave }: { onSave: (player: Player, playerStats: PlayerStats) => void }) => {\n  const [player, playerStats] = randomPlayer();\n  const [form, setForm] = React.useState<Build>(player.build);\n  const [lore, setLore] = React.useState(player.lore);\n  const setField = <T extends keyof Build>(field: T, value: Build[T]) => {\n    setForm({\n      ...form,\n      [field]: value,\n    });\n  };\n  const onFormSubmit = (e: any) => {\n    e.preventDefault();\n    onSave({\n      id: \"p-1\",\n      lore,\n      build: form,\n    }, playerStats);\n  };\n  const displayType = (type: keyof Build) => <b>{form[type].display}</b>;\n\n  const postBuildPlayerStats = buildPlayer({ ...player, build: form }, playerStats, [randomEnemy()[1]])[0];\n\n  return (\n    <Form onSubmit={onFormSubmit}>\n      <Container fluid style={{ marginBottom: '105px' }}>\n        <Row className=\"g-2\">\n          {safeEntries(build)\n            .filter(([type, _]) => !systemBuildKeys.has(type))\n            .map(([type, values]) =>\n              <ElementPicker\n                setField={(value) => setField(type, value)}\n                section={type}\n                options={(values as Item[])}\n                key={type}\n                isSelected={(value) => form[type].display === value.display} />)\n          }\n        </Row>\n        <Navbar fixed=\"bottom\" bg=\"dark\" variant=\"dark\" style={{ maxHeight: '100px' }}>\n          <Container>\n            <Navbar.Text>You are <i onClick={() => setLore((lore) => ({ ...lore, name: randomName() }))}>{lore.name}</i>, the {displayType('skill')} {displayType('class')} {displayType('charm')}<br />who wields a {displayType('weapon')} and a {displayType('offhand')}<br />and wears {displayType('armor')} with {displayType('headgear')} and {displayType('footwear')}</Navbar.Text>\n            <Navbar.Text>\n              {postBuildPlayerStats.hp.current}/{postBuildPlayerStats.hp.max} <br />\n              {postBuildPlayerStats.stamina.current}/{postBuildPlayerStats.stamina.max}  ({postBuildPlayerStats.staminaPerTurn.current >= 0 && \"+\"}{postBuildPlayerStats.staminaPerTurn.current})<br />\n              Attack {postBuildPlayerStats.attack.current} | Defence {postBuildPlayerStats.defence.current} | Speed {postBuildPlayerStats.speed.current}\n            </Navbar.Text>\n            <Button type=\"submit\">This is me!</Button>\n          </Container>\n        </ Navbar>\n      </Container >\n    </Form >\n  );\n};\n\nconst ElementPicker = ({ isSelected, section, options, setField }: {\n  options: Item[], isSelected: (value: Item) => boolean, setField: (value: Item) => void, section: string\n}) => {\n  const [scrollTo, scrollRef] = useScroll({\n    behavior: 'smooth',\n    block: 'start',\n  });\n\n  return (\n    <Row>\n      <Form.Label>{section}</Form.Label>\n      <br />\n      <ButtonGroup size=\"lg\" className=\"mb-2\">\n        {options.map((item) => (\n          <Button\n            key={item.display}\n            name={section}\n            id={`${item.display}`}\n            variant={isSelected(item) ? 'primary' : 'secondary'}\n            onClick={() => { setField(item); scrollTo(); }}\n          >{item.display}</Button>\n        ))}\n      </ButtonGroup>\n      <div id={`${section}-scroll`} ref={scrollRef} />\n    </Row>\n  );\n}\n\nexport default PlayerBuilder;\n","import { Ref, useRef } from \"react\";\n\ntype ScrollToFn = () => void;\n\nexport default function useScroll<T extends Element>(scrollParams: ScrollIntoViewOptions): [ScrollToFn, Ref<any>] {\n  const elRef = useRef<T>(null);\n  const executeScroll = () => elRef.current!.scrollIntoView(scrollParams);\n\n  return [executeScroll, elRef];\n};\n","import React from \"react\";\nimport { Container, ButtonGroup, Form, Button, Navbar } from \"react-bootstrap\";\n\nimport { Player, Enemies, EnemiesStats, Build, EnemyInfo } from \"../game/types\";\nimport { enemies, randomEnemy } from \"../game/data\";\n\nconst EncounterBuilder = ({ player, onSave }: { player: Player, onSave: (enemies: Enemies, enemiesStats: EnemiesStats) => void }) => {\n  const [encounter, setEncounter] = React.useState<EnemyInfo[]>([]);\n  const onFormSubmit = (e: any) => {\n    e.preventDefault();\n    const enemies = encounter.map(a => a[0]);\n    const enemiesStats = encounter.map(a => a[1]);\n    // Size enforced by UI\n    onSave(enemies as Enemies, enemiesStats as EnemiesStats);\n  };\n  const displayType = (type: keyof Build) => <b>{player.build[type].display}</b>;\n  return (\n    <Form onSubmit={onFormSubmit}>\n      <Container fluid style={{ marginBottom: encounter.length > 0 ? '205px' : '105px' }}>\n        <ButtonGroup size=\"lg\" className=\"mb-2\">\n          {enemies.map((enemy) =>\n            <Button\n              key={enemy[0].lore.name}\n              disabled={encounter.length > 4}\n              onClick={() => setEncounter((e) => [...e, enemy])}\n            >{enemy[0].lore.name}</Button>\n          )}\n        </ButtonGroup>\n      </Container >\n      {\n        encounter.length > 0 &&\n        <Navbar fixed=\"bottom\" bg=\"dark\" variant=\"dark\" style={{ marginBottom: '100px' }}>\n          <Container fluid>\n            <ButtonGroup size=\"sm\" className=\"mb-2\">\n              {encounter.map((enemy, idx) => <Button key={`${enemy[0].lore.name}-${idx}`} onClick={() => setEncounter((e) => { let found = false; return e.filter((m) => (found || m[0].lore.name !== enemy[0].lore.name) || !(found = true)); })}>{enemy[0].lore.name}</Button>)}\n            </ButtonGroup>\n          </Container>\n        </ Navbar>\n      }\n      <Navbar fixed=\"bottom\" bg=\"dark\" variant=\"dark\" style={{ maxHeight: '100px' }}>\n        <Container>\n          <Navbar.Text>You are <i>{player.lore.name}</i>, the {displayType('skill')} {displayType('class')} {displayType('charm')}<br />who wields a {displayType('weapon')} and a {displayType('offhand')}<br />and wears {displayType('armor')} with {displayType('headgear')} and {displayType('footwear')}</Navbar.Text>\n          <ButtonGroup>\n            <Button\n              disabled={encounter.length < 0 || encounter.length > 4}\n              onClick={(_) => setEncounter((e) => [...e, randomEnemy()])}>\n              Add Random\n            </Button>\n            <Button type=\"submit\" disabled={encounter.length < 1 || encounter.length > 5}>To Battle!</Button>\n          </ButtonGroup>\n        </Container>\n      </ Navbar>\n    </Form >\n  );\n};\n\nexport default EncounterBuilder;\n","import React from \"react\";\nimport { Container, Card, Row, Button } from \"react-bootstrap\";\n\nconst Menu: React.FC<{\n  title: string;\n  states: string[];\n  onClick: (value: string) => void\n}> = ({ title, states, onClick }) =>\n    <Container fluid style={{ marginBottom: '105px' }}>\n      <Row className=\"g-2\">\n        <Card.Title>\n          {title}\n        </Card.Title>\n      </Row>\n      {states.map(state =>\n        <Row className=\"g-2\" key={state}>\n          <Button size=\"lg\" className=\"mb-2\"\n            key={state}\n            variant={'primary'}\n            onClick={() => { onClick(state); }}\n          >{state}</Button>\n        </Row>\n      )}</Container >;\n\nexport default Menu;\n","export default function geneticAlgorithmConstructor(options) {\n\n    function settingDefaults() {\n        return {\n\n            mutationFunction: function (phenotype) { return phenotype },\n\n            crossoverFunction: function (a, b) { return [a, b] },\n\n            fitnessFunction: function (phenotype) { return 0 },\n\n            doesABeatBFunction: undefined,\n\n            population: [],\n            populationSize: 100,\n        }\n    }\n\n    function settingWithDefaults(settings, defaults) {\n        settings = settings || {}\n\n        settings.mutationFunction = settings.mutationFunction || defaults.mutationFunction\n        settings.crossoverFunction = settings.crossoverFunction || defaults.crossoverFunction\n        settings.fitnessFunction = settings.fitnessFunction || defaults.fitnessFunction\n\n        settings.doesABeatBFunction = settings.doesABeatBFunction || defaults.doesABeatBFunction\n\n        settings.population = settings.population || defaults.population\n        if (settings.population.length <= 0) throw Error(\"population must be an array and contain at least 1 phenotypes\")\n\n        settings.populationSize = settings.populationSize || defaults.populationSize\n        if (settings.populationSize <= 0) throw Error(\"populationSize must be greater than 0\")\n\n        return settings\n    }\n\n    var settings = settingWithDefaults(options, settingDefaults())\n\n    function populate() {\n        var size = settings.population.length\n        while (settings.population.length < settings.populationSize) {\n            const rand = Math.floor(Math.random() * size);\n            settings.population.push(\n                mutate(\n                    cloneJSON(settings.population[Math.floor(rand)])\n                )\n            )\n        }\n    }\n\n    function cloneJSON(object) {\n        return JSON.parse(JSON.stringify(object))\n    }\n\n    function mutate(phenotype) {\n        return settings.mutationFunction(cloneJSON(phenotype))\n    }\n\n    function crossover(phenotype) {\n        phenotype = cloneJSON(phenotype)\n        var mate = settings.population[Math.floor(Math.random() * settings.population.length)]\n        mate = cloneJSON(mate)\n        return settings.crossoverFunction(phenotype, mate)[0]\n    }\n\n    function doesABeatB(a, b) {\n        if (settings.doesABeatBFunction) {\n            return settings.doesABeatBFunction(a, b)\n        } else {\n            return settings.fitnessFunction(a) >= settings.fitnessFunction(b)\n        }\n    }\n\n    function compete() {\n        var nextGeneration = []\n\n        for (var p = 0; p < settings.population.length - 1; p += 2) {\n            var phenotype = settings.population[p];\n            var competitor = settings.population[p + 1];\n\n            nextGeneration.push(phenotype)\n            if (doesABeatB(phenotype, competitor)) {\n                if (Math.random() < 0.5) {\n                    nextGeneration.push(mutate(phenotype))\n                } else {\n                    nextGeneration.push(crossover(phenotype))\n                }\n            } else {\n                nextGeneration.push(competitor)\n            }\n        }\n\n        settings.population = nextGeneration;\n    }\n\n\n\n    function randomizePopulationOrder() {\n\n        for (var index = 0; index < settings.population.length; index++) {\n            var otherIndex = Math.floor(Math.random() * settings.population.length)\n            var temp = settings.population[otherIndex]\n            settings.population[otherIndex] = settings.population[index]\n            settings.population[index] = temp\n        }\n    }\n\n    return {\n        evolve: function (options) {\n\n            if (options) {\n                settings = settingWithDefaults(options, settings)\n            }\n\n            populate()\n            randomizePopulationOrder()\n            compete()\n            return this\n        },\n        best: function () {\n            var scored = this.scoredPopulation()\n            var result = scored.reduce(function (a, b) {\n                return a.score >= b.score ? a : b\n            }, scored[0]).phenotype\n            return cloneJSON(result)\n        },\n        bestScore: function () {\n            return settings.fitnessFunction(this.best())\n        },\n        population: function () {\n            return cloneJSON(this.config().population)\n        },\n        scoredPopulation: function () {\n            return this.population().map(function (phenotype) {\n                return {\n                    phenotype: cloneJSON(phenotype),\n                    score: settings.fitnessFunction(phenotype)\n                }\n            })\n        },\n        config: function () {\n            return cloneJSON(settings)\n        },\n        clone: function (options) {\n            return geneticAlgorithmConstructor(\n                settingWithDefaults(options,\n                    settingWithDefaults(this.config(), settings)\n                )\n            )\n        }\n    }\n}\n","import GeneticAlgorithmConstructor, { GeneticAlgorithmConfig, ScoredPhenotype } from '../geneticalgorithm/geneticalgorithm';\nimport { handlePlayerEffect, makeGameNew, playerActions, setSelected } from './playGame';\nimport Chance from 'chance';\nimport { Enemies, EnemiesStats, Enemy, EnemyInfo, EnemyStats, MonsterTarget, Play, Player, Seed } from './types';\nimport { build, enemies, playerStatsDefault, previousState, randomEnemy, randomPlayer } from './data';\nimport { Seq } from 'immutable';\nimport { rangeArr } from './zFunDump';\n\nexport type TinkererOptions = typeof defaultTinkererOptions & { turns?: number };\n\nexport const defaultTinkererOptions = {\n  playerSeed: \"Miau\",\n  weights: { monster: 0.70, player: 0.125, turn: 0.1, stamina: 0.075 },\n  debug: false,\n};\n\nexport function findBestPlay(play: Play, iter: number, optionsOverride?: Partial<TinkererOptions>): ScoredPhenotype<Play>[] {\n  const options: TinkererOptions = { ...defaultTinkererOptions, ...optionsOverride };\n  const rand = new Chance(options.playerSeed);\n  const config: GeneticAlgorithmConfig<Play> = {\n    mutationFunction: (oldPlay) => {\n      const latestState = previousState(oldPlay);\n      const monsterHealth = latestState.enemies.reduce((acc, monster) => acc + monster.hp.current, 0);\n      const playerHealth = latestState.player.hp.current;\n      if (playerHealth === 0 || monsterHealth === 0) {\n        return oldPlay;\n      }\n      let newPlay = oldPlay;\n      while (rand.d6() === 6 || (previousState(newPlay).enemies[previousState(newPlay).target]?.hp ?? 0) <= 0) {\n        newPlay = setSelected(newPlay, rand.natural({ min: 0, max: previousState(newPlay).enemies.length - 1 }) as MonsterTarget);\n      }\n      const latest = previousState(newPlay);\n      const actions = playerActions(play.player, latest.inventory);\n      const unavailable = actions.map((a, idx) => [a, idx] as const).filter(([a, _]) => a.stamina > latest.player.stamina.current).map(([_, idx]) => idx);\n      newPlay = handlePlayerEffect(\n        newPlay,\n        rand.natural({ min: 0, max: actions.length - 1, exclude: unavailable })\n      );\n      return newPlay;\n    },\n    fitnessFunction: (play) => {\n      const latestState = previousState(play);\n      const monsterHealth = latestState.enemies.reduce((acc, monster) => acc + monster.hp.current, 0);\n      const playerHealth = latestState.player.hp.current;\n      const playerStamina = latestState.player.stamina.current;\n      const startPlayerHealth = play.states[0].player.hp.max;\n      const startPlayerStamina = play.states[0].player.stamina.max;\n      const startMonsterHealth = play.states[0].enemies.reduce((acc, monster) => acc + monster.hp.current, 0);\n\n      const monsterKillingFitness = ((startMonsterHealth - monsterHealth) / startMonsterHealth);\n      const playerAlivenessFitness = (playerHealth / startPlayerHealth);\n      const killSpeedFitness = (play.turns - play.states.length) / play.turns;\n      const staminaFitness = (playerStamina / startPlayerStamina);\n\n      const fitness = (monsterKillingFitness * options.weights.monster) + (playerAlivenessFitness * options.weights.player) + (killSpeedFitness * options.weights.turn) + (staminaFitness * options.weights.stamina);\n      if (options.debug) {\n        console.log(`MH: ${monsterHealth} | PH: ${playerHealth} | TR: ${play.states.length}\\nFitness: ${fitness} | MF: ${monsterKillingFitness} | PF: ${playerAlivenessFitness} | SF: ${staminaFitness} | TF: ${killSpeedFitness}\\nWeights: ${JSON.stringify(options.weights)}`);\n      }\n      return fitness;\n    },\n    population: rangeArr(iter).map((_) => play),\n    populationSize: iter,\n  }\n\n  const turns = optionsOverride?.turns ?? play.turns;\n  let gen = new GeneticAlgorithmConstructor<Play>(config);\n  for (let i = 0; i < turns; i++) {\n    gen = gen.evolve();\n  }\n  return Seq(gen.scoredPopulation()).sortBy(a => 1000 / a.score).toArray();\n}\n\nexport const findBestBuild = (players: Player[], enemies: [Seed, EnemyInfo[]][], iter: number, gameIter: number, populationTotal?: number, optionsOverride?: Partial<TinkererOptions>): ScoredPhenotype<Player>[] => {\n  const options: TinkererOptions = { ...defaultTinkererOptions, ...optionsOverride };\n  const rng = new Chance(options.playerSeed);\n  const config: GeneticAlgorithmConfig<Player> = {\n    mutationFunction: (player: Player) => {\n      const toChange = rng.pickone(Object.keys(player.build)) as keyof typeof build;\n      return {\n        ...player,\n        build: {\n          ...player.build,\n          [toChange]: rng.pickone(build[toChange]),\n        }\n      };\n    },\n    fitnessFunction: (player: Player) =>\n      Seq(enemies).flatMap(g =>\n        Seq(\n          findBestPlay(makeGameNew(player, playerStatsDefault, g[1].map(a => a[0]) as Enemies, g[1].map(a => a[1]) as EnemiesStats, optionsOverride?.turns ?? 50, g[0]), gameIter, optionsOverride)\n        ).take(2)\n      ).reduce((acc, v) => acc + v.score, 0),\n    population: players,\n    populationSize: populationTotal ?? players.length,\n  }\n\n  let gen = new GeneticAlgorithmConstructor<Player>(config);\n  for (let i = 0; i < iter; i++) {\n    gen = gen.evolve();\n  }\n\n  return Seq(gen.scoredPopulation()).sortBy(a => 1000 / a.score).toArray();\n}\n","import React from \"react\";\nimport { Card, Button, OverlayTrigger, Popover } from \"react-bootstrap\";\nimport { Enemy, Effect, EnemyStats } from \"../game/types\";\nimport { Seq } from \"immutable\";\n\nconst skillPercents = (effects: Effect[]) =>\n  Seq(effects).countBy((e) => e.display).toArray().map(([display, v], idx) => {\n    const { range, priority, tooltip } = effects.find(a => a.display === display)!!;\n    return <OverlayTrigger\n      key={idx}\n      placement=\"right\"\n      delay={{ show: 100, hide: 250 }}\n      overlay={<Popover>\n        <Popover.Header as=\"h3\">{display}</Popover.Header>\n        <Popover.Body>\n          {tooltip}<br />:{priority}<br />:{range.length === 5 ? 'Any' : range.length === 0 ? 'None' : range.map(a => a + 1).join(\", \")}\n        </Popover.Body>\n      </Popover>}\n    ><>[{(v / effects.length * 100).toFixed(2)}%] {display}<br key={idx} /></>\n    </OverlayTrigger>\n  });\n\nconst EnemyCard: React.FC<{\n  enemy: Enemy;\n  enemyStats: EnemyStats;\n  latestAttack: string | undefined;\n  isSelected?: boolean;\n  onSelect: () => void;\n  canAct: boolean;\n  hotkey: string;\n}> = ({ enemy, enemyStats, isSelected, onSelect, latestAttack, canAct, hotkey }) => (\n  <Card bg={isSelected ? \"info\" : undefined}>\n    <Card.Body>\n      <Card.Title>{enemy.lore.name} {enemyStats.hp.current > 0 ? \"\" : (<b>DEAD</b>)}</Card.Title>\n      <Card.Text>:{enemyStats.hp.current} :{enemyStats.distance + 1}</Card.Text>\n      <Card.Text>Attack {enemyStats.attack.current}<br />Defence {enemyStats.defence.current}<br />Speed {enemyStats.speed.current}</Card.Text>\n      {enemyStats.status.bleed.turns > 0 && ` ${enemyStats.status.bleed.turns} `}\n      {latestAttack && (<Card.Text>Latest attack: {latestAttack}</Card.Text>)}\n      <Card.Text>\n        Next attack prediction:\n        <br />\n        {skillPercents(enemy.rolls[enemyStats.distance].map((idx) => enemy.effects[idx]))}\n        <br />\n      </Card.Text>\n      {canAct && (<Button disabled={isSelected} onClick={onSelect}>[<i>{hotkey.toUpperCase()}</i>] Select</Button>)}\n    </Card.Body>\n  </Card>\n);\n\nexport default EnemyCard;\n","import React from \"react\";\nimport { Card, Button, Stack, ToggleButton, ButtonGroup, Popover, OverlayTrigger } from \"react-bootstrap\";\nimport { DisabledSkills, InventoryStats, Player, PlayerStats, safeEntries } from \"../game/types\";\nimport { Set } from 'immutable';\nimport { clamp } from \"../game/zFunDump\";\nimport { playerActions } from \"../game/playGame\";\n\nconst PlayerCard: React.FC<{\n  selectedButtons: Set<string>,\n  player: Player;\n  playerStats: PlayerStats;\n  inventoryStats: InventoryStats;\n  canAct: boolean;\n  lastAction: string | undefined;\n  onClickEffect: (index: number) => void;\n  disabledSkills: DisabledSkills;\n  setDisabledSkills: (skills: DisabledSkills) => void;\n}> = ({ selectedButtons, player, playerStats, inventoryStats, onClickEffect, canAct, lastAction, disabledSkills, setDisabledSkills, }) => {\n  const passives = safeEntries(player.build)\n    .map(([k, e]) => [k, e, [...(e.bot ?? []), ...(e.eot ?? [])]] as const);\n\n  const hasPassives = passives.reduce((acc, [k, e, passives]) => passives.length > 0, false);\n  return <Card>\n    <Card.Body>\n      <Card.Title>{player.lore.name}{playerStats.hp.current > 0 ? \"\" : (<b> DEAD </b>)}</Card.Title>\n      <Card.Subtitle className=\"mb-2 text-muted\">\n        {player.build.class.display}\n      </Card.Subtitle>\n      <Card.Text>Attack {playerStats.attack.current} | Defence {playerStats.defence.current} | Speed {playerStats.speed.current}</Card.Text>\n      <Card.Text>{playerStats.hp.current}/{playerStats.hp.max} </Card.Text>\n      <Card.Text>{playerStats.stamina.current}/{playerStats.stamina.max}  ({playerStats.staminaPerTurn.current >= 0 && \"+\"}{playerStats.staminaPerTurn.current})</Card.Text>\n      {playerStats.status.bleed.turns > 0 && <Card.Text>` ${playerStats.status.bleed.turns} `</Card.Text>}\n      {lastAction && (<Card.Text>Last action: {lastAction}</Card.Text>)}\n    </Card.Body>\n    {canAct && hasPassives && (<>\n      <b>Passives</b>\n      <ButtonGroup>\n        {passives\n          .map(([k, e, passives], idx) => passives.length > 0 && (<OverlayTrigger\n            key={idx}\n            placement=\"right\"\n            delay={{ show: 100, hide: 250 }}\n            overlay={<Popover>\n              <Popover.Header as=\"h3\">{e.display}</Popover.Header>\n              <Popover.Body>\n                {e.tooltip}\n              </Popover.Body>\n            </Popover>}\n          >\n            <ToggleButton\n              checked={!Set(disabledSkills).has(k)}\n              value={k}\n              id={`passive-skill-${k}`}\n              type=\"checkbox\"\n              variant=\"outline-primary\"\n              onChange={(event) => setDisabledSkills(\n                event.currentTarget.checked\n                  ? Set(disabledSkills).delete(k).toArray()\n                  : Set(disabledSkills).add(k).toArray())}>\n              {e.display}\n            </ToggleButton>\n          </OverlayTrigger>\n          ))}\n      </ButtonGroup>\n    </>)}\n    {canAct && (<Card.Body>\n      <Stack direction=\"horizontal\" gap={2}>\n        {playerActions(player, inventoryStats)\n          .map((e, idx) => (<OverlayTrigger\n            key={e.display}\n            placement=\"top\"\n            delay={{ show: 100, hide: 250 }}\n            overlay={<Popover>\n              <Popover.Header as=\"h3\">{e.display}</Popover.Header>\n              <Popover.Body>\n                {e.tooltip}\n              </Popover.Body>\n            </Popover>}\n          >\n            <div>\n              <Button\n                active={selectedButtons.has(e.display)}\n                disabled={playerStats.stamina.current < e.stamina}\n                onClick={(_) => onClickEffect(idx)}\n              >\n                [<i>{idx + 1}</i>] <b>{e.display}</b>\n              </Button>\n              <br />\n              <Card.Text>:{e.stamina} :{clamp(e.priority - playerStats.speed.current, 0, 4)}<br />:{e.range.length === 5 ? 'Any' : e.range.map(a => a + 1).join(\", \")}</Card.Text>\n            </div>\n          </OverlayTrigger>\n          ))}\n      </Stack>\n    </Card.Body>)}\n  </Card>\n}\n\nexport default PlayerCard;\n","import { Container, Row, Col, Card, Modal, ButtonGroup } from \"react-bootstrap\";\n\nimport { DisabledSkills, MonsterTarget, Play } from \"../game/types\";\n\nimport EnemyCard from \"./Enemy\";\nimport PlayerCard from \"./Player\";\nimport usePressedKeys from \"../hooks/usePressedKeys\";\nimport { playerActions } from \"../game/playGame\";\nimport { Seq, Set } from \"immutable\";\nimport { previousState } from \"../game/data\";\nimport { Button } from \"react-bootstrap\";\nimport saveAs from 'file-saver';\nimport { useCallback, useEffect, useState } from \"react\";\nimport { globals, updateGlobals } from \"../game/modding\";\nimport { useForceRerender } from \"../hooks/useForceRerender\";\n\nexport type GameProps = {\n  game: Play;\n  setSelected: (target: MonsterTarget) => void;\n  setDisabledSkills: (disabled: DisabledSkills) => void;\n  handlePlayerEffect: (index: number) => void,\n  solveGame: (iterations: number) => void,\n  hint: (iterations: number) => void,\n  timeTravel: { undo: () => void; redo: (() => void) | undefined } | undefined,\n  onMenu: () => void,\n};\n\nconst monsterHotkeys = [\"q\", \"w\", \"e\", \"r\", \"t\", \"y\"];\n\nconst Game = ({ handlePlayerEffect, setSelected, setDisabledSkills, game, solveGame, timeTravel, hint, onMenu }: GameProps): JSX.Element => {\n  const { player, enemies } = game;\n  const { player: playerStats, enemies: enemiesStats, target, lastAttacks, disabledSkills, inventory: inventoryStats } = previousState(game);\n  const [isLogShown, setShowLog] = useState(false);\n  const forceUpdate = useForceRerender();\n\n  useEffect(() => {\n    updateGlobals({ ingame: { game, forceUpdate } });\n    return () => updateGlobals({ ingame: undefined });\n  }, [game, forceUpdate]);\n\n  const handleCloseLog = () => setShowLog(false);\n  const handleShowLog = () => setShowLog(true);\n\n  const playerSkills = playerActions(player, inventoryStats);\n  const monsterHealth = enemiesStats.reduce((acc, m) => m.hp.current + acc, 0);\n  const isPlayerAlive = playerStats.hp.current > 0;\n  const areMonstersAlive = monsterHealth > 0;\n  const endGame = game.states.length < game.turns;\n  const canAct = isPlayerAlive && areMonstersAlive && endGame;\n\n  const pressed = usePressedKeys((key) => {\n    if (!canAct) return;\n    const valNum = parseInt(key);\n    if (valNum > 0 && valNum <= playerSkills.length) {\n      const hasStamina = playerSkills[valNum - 1].stamina <= playerStats.stamina.current;\n      if (!hasStamina) return;\n      handlePlayerEffect(valNum - 1);\n    }\n\n    if (key === \"Escape\") {\n      onMenu();\n    }\n    if (key === \"h\") {\n      hint(100);\n    }\n\n    if (key === \"l\") {\n      setShowLog(!isLogShown);\n    }\n\n    if (key === \"s\") {\n      save();\n    }\n\n    if (key === \"a\" && game.states.length > 1 && timeTravel) {\n      timeTravel.undo();\n    }\n    if (key === \"d\" && timeTravel && timeTravel.redo != null) {\n      timeTravel.redo();\n    }\n\n    if (key === monsterHotkeys[0] && enemies.length > 0) {\n      setSelected(0 as MonsterTarget);\n    }\n    if (key === monsterHotkeys[1] && enemies.length > 1) {\n      setSelected(1 as MonsterTarget);\n    }\n    if (key === monsterHotkeys[2] && enemies.length > 2) {\n      setSelected(2 as MonsterTarget);\n    }\n    if (key === monsterHotkeys[3] && enemies.length > 3) {\n      setSelected(3 as MonsterTarget);\n    }\n    if (key === monsterHotkeys[4] && enemies.length > 4) {\n      setSelected(4 as MonsterTarget);\n    }\n  });\n\n  const selectedButtons = Set<string>([...pressed].flatMap((key: string) => {\n    const valNum = parseInt(key);\n    if (valNum > 0 && valNum <= playerSkills.length) {\n      return [playerSkills[valNum - 1].display];\n    } else {\n      return [];\n    }\n  }));\n\n  const save = useCallback(() => {\n    const blob = new Blob([JSON.stringify(game)], { type: \"application/json;charset=utf-8\" });\n    saveAs(blob, `buildmancer-${Date.now()}.json`);\n  }, [game]);\n\n  return (\n    <>\n      <Container fluid>\n        <Row className=\"justify-content-center align-items-flex-start\">\n          <Col sm={12} md={8}>\n            <Button onClick={onMenu}>[<i>Esc</i>] MAIN MENU</Button>\n            <Card.Title>\n              {!isPlayerAlive ? (<b>DEFEAT</b>) : !areMonstersAlive ? (<b>VICTORY</b>) : \"\"} Turn {game.states.length} out of {game.turns}\n            </Card.Title>\n            <PlayerCard\n              player={player}\n              playerStats={playerStats}\n              inventoryStats={inventoryStats}\n              disabledSkills={disabledSkills}\n              setDisabledSkills={setDisabledSkills}\n              onClickEffect={(idx) => handlePlayerEffect(idx)}\n              selectedButtons={selectedButtons}\n              lastAction={lastAttacks.filter(a => a.origin === 'Player' && a.phase === 'MAIN').map(a => `${a.display}`).join(\" -> \") ?? undefined}\n              canAct={canAct} />\n            {timeTravel != null && (<Row>\n              <ButtonGroup>\n                {game.states.length > 1 && (<Button onClick={(_) => timeTravel.undo()}>[<i>A</i>] Undo </Button>)}\n                {timeTravel.redo && (<Button onClick={(_) => timeTravel.redo!!()}>[<i>D</i>] Redo </Button>)}\n              </ButtonGroup>\n            </Row>)}\n            <Row>\n              <ButtonGroup>\n                <Button onClick={(_) => hint(100)}><i>[H]</i> Hint</Button>\n              </ButtonGroup>\n            </Row>\n            <Row>\n              {Seq(enemies).zip(Seq(enemiesStats)).map(([enemy, stats], idx) => (\n                <Col key={idx} xs={6} md={4}>\n                  <EnemyCard\n                    key={idx}\n                    enemyStats={stats}\n                    enemy={enemy}\n                    canAct={canAct}\n                    latestAttack={Seq(lastAttacks).filter(({ origin, phase }) => origin === idx && phase === 'MAIN').map(a => `${a.display}`).join(\" -> \") ?? undefined}\n                    isSelected={idx === target}\n                    onSelect={() => setSelected(idx as MonsterTarget)}\n                    hotkey={monsterHotkeys[idx]}\n                  />\n                </Col>\n              ))}\n            </Row>\n            <Card.Title>\n              Debug\n            </Card.Title>\n            <Row>\n              <ButtonGroup>\n                <Button onClick={handleShowLog}>[<i>L</i>] Log </Button>\n                <Button onClick={save}>[<i>S</i>] Dump to file </Button>\n              </ButtonGroup>\n            </Row>\n            <Card.Title>\n              Cheats\n            </Card.Title>\n            <Row>\n              <ButtonGroup>\n                <Button onClick={(_) => solveGame(100)}>Solve </Button>\n                <Button onClick={(_) => solveGame(1000)}>Solve thoroughly </Button>\n              </ButtonGroup>\n            </Row>\n          </Col>\n        </Row>\n      </Container>\n      <Modal show={isLogShown} onHide={handleCloseLog} scrollable={true} centered={true}>\n        <Modal.Header closeButton>\n          <Modal.Title>Game Log</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          {game.states.map((s, idx) => (\n            <div key={idx}>\n              <b>Turn {idx}</b><br />\n              Player: {JSON.stringify(s.player, null, 2)}<br />\n              Enemies: {JSON.stringify(s.enemies, null, 2)}<br />\n              Inventory?: {JSON.stringify(s.inventory, null, 2)}<br />\n              Target [{s.target}]<br />\n              Bot?: {JSON.stringify(s.bot, null, 2)}<br />\n              Eot?: {JSON.stringify(s.eot, null, 2)}<br />\n              Actions:<br />\n              {s.lastAttacks.map((a, idx) => (<div key={idx}>{\"-->\"} {JSON.stringify(a, null, 2)}<br /></div>))}\n            </div>\n          ))}\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"primary\" onClick={handleCloseLog}>\n            Close\n          </Button>\n        </Modal.Footer>\n      </Modal >\n    </>\n  );\n};\n\nexport default Game;\n","import React from \"react\";\n\nexport function useForceRerender() {\n  const [value, setValue] = React.useState(false);\n  return () => setValue(!value);\n}\n","import { useEffect, useCallback, useState } from \"react\";\n\nexport default function usePressedKeys(onUp: (e: string) => void): Set<string> {\n\n  const [pressedKeys, updatePressedKeys] = useState(new Set<string>());\n\n  const downHandler = ({ key }: { key: string }) => {\n    updatePressedKeys((set) => new Set([...set, key]));\n  }\n\n  const upHandler = useCallback(({ key }: { key: string }) => {\n    updatePressedKeys((set) => new Set([...set].filter((k) => k !== key)));\n    onUp(key);\n  }, [onUp]);\n\n  useEffect(() => {\n    window.addEventListener(\"keydown\", downHandler);\n    window.addEventListener(\"keyup\", upHandler);\n\n    return () => {\n      window.removeEventListener(\"keydown\", downHandler);\n      window.removeEventListener(\"keyup\", upHandler);\n    };\n  }, [upHandler]);\n\n  return pressedKeys;\n}","import { Seq } from \"immutable\";\nimport React from \"react\";\nimport { findBestPlay } from \"../../game/tinkerer\";\nimport { previousState } from \"../../game/data\";\nimport { PlayState, playState, setSelected, setDisabledSkills, handlePlayerEffect } from \"../../game/playGame\";\nimport { Play, Snapshot } from \"../../game/types\";\nimport Game from \"../Game\";\n\nconst SingleGame = ({ play, timeTravel, onGameEnd, onMenu }: { play: Play; timeTravel: boolean, onGameEnd: (state: PlayState, play: Play) => void, onMenu: () => void }) => {\n  const [game, setGame] = React.useState<Play>(play);\n  const [redo, setRedo] = React.useState<Snapshot[]>([]);\n\n  React.useEffect(() => {\n    setGame(play);\n  }, [play]);\n\n  React.useEffect(() => {\n    const gameState = playState(game);\n    const hasEnded = gameState !== 'playing';\n    if (hasEnded) {\n      onGameEnd(gameState, game);\n    }\n  }, [game]);\n\n  const timeTravelObj = timeTravel ? {\n    redo: redo.length > 0 ? (() => {\n      const newRedo = [...redo];\n      const latest = newRedo.pop() as Snapshot;\n      setRedo(newRedo);\n      setGame({ ...game, states: [...game.states, latest] });\n    }) : undefined,\n    undo: () => {\n      setRedo([...redo, previousState(game)]);\n      setGame({ ...game, states: [game.states[0], ...game.states.slice(1, -1)] });\n    }\n  } : undefined;\n\n  return (<Game\n    game={game}\n    timeTravel={timeTravelObj}\n    onMenu={onMenu}\n    setSelected={(idx) => { setRedo([]); setGame(setSelected(game, idx)); }}\n    setDisabledSkills={(disabled) => { setRedo([]); setGame(setDisabledSkills(game, disabled)) }}\n    handlePlayerEffect={(idx) => { setRedo([]); setGame(handlePlayerEffect(game, idx)); }}\n    solveGame={(iterations) => setGame(Seq(findBestPlay(game, iterations, { turns: game.turns - game.states.length })).maxBy(a => a.score)!!.phenotype)}\n    hint={(iterations) =>\n      setGame({\n        ...game,\n        states: [...game.states, Seq(findBestPlay(game, iterations, { turns: game.turns - game.states.length })).maxBy(a => a.score)!!.phenotype.states[game.states.length]]\n      })\n    }\n  />\n  );\n}\n\nexport default SingleGame;\n","import React from \"react\";\nimport { Form, Col, Row, Alert, Button, Container } from \"react-bootstrap\";\nimport { Play } from \"../../game/types\";\nimport { playSchema } from \"../../game/typesSchemas\";\n\nconst LoadScreen = ({ onLoad, onMenu }: { onLoad: (g: Play) => void; onMenu: () => void }) => {\n  const [loadError, setLoadError] = React.useState<string | undefined>();\n  const load = (data: string) => {\n    try {\n      const playRaw = JSON.parse(data);\n      try {\n        // FIXME update schema\n        //playSchema.parse(playRaw);\n        onLoad(playRaw as Play);\n      } catch (e) {\n        setLoadError(\"Failed to Load - Invalid Data\");\n      }\n    } catch (e) {\n      setLoadError(\"Failed to Load - Bad Data\");\n    }\n  }\n  const onFormSubmit = (e: any) => {\n    e.preventDefault();\n    if (e.target?.fileData?.files[0] != null) {\n      const reader = new FileReader();\n      reader.onloadend = (ev: ProgressEvent<FileReader>) => {\n        const result = ev.target?.result as string | undefined;\n        if (result != null) {\n          load(result);\n        } else {\n          setLoadError(\"Failed to read file\");\n        }\n      };\n      reader.readAsText(e.target.fileData.files[0])\n    } else if (e.target?.rawData?.value != null && e.target?.rawData?.value != \"\") {\n      load(e.target.rawData.value);\n    }\n  };\n  return <Form onSubmit={onFormSubmit}>\n    <Container fluid>\n      <Col>\n        <Row>\n          {loadError && (<><Alert variant={'danger'}>{loadError}</Alert><br /><br /></>)}\n        </Row>\n        <Row>\n          <Form.Group>\n            <Form.Label>Load File</Form.Label>\n            <Form.Control type=\"file\" name=\"fileData\" accept=\".json\" />\n            <Form.Text muted>Select the file to load</Form.Text>\n          </Form.Group>\n        </Row>\n        <br />\n        <Row>\n          <Form.Group>\n            <Form.Label>Load</Form.Label>\n            <Form.Control name=\"rawData\" as=\"textarea\" rows={3} placeholder=\"Save Data\" />\n            <Form.Text muted>Paste the text of your savegame here</Form.Text>\n          </Form.Group>\n        </Row>\n        <br />\n        <Button variant=\"primary\" type=\"submit\">Load</Button>\n      </Col>\n      <br />\n      <Button onClick={onMenu}>MAIN MENU</Button>\n    </Container>\n  </Form>;\n}\n\nexport default LoadScreen;\n","import \"./App.css\";\n// import { readString } from \"react-papaparse\";\nimport { Snapshot, Play, EnemyStats, Enemy, EnemiesStats, Enemies } from \"./game/types\";\n\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport PlayerBuilder from \"./components/PlayerBuilder\";\nimport EncounterBuilder from \"./components/EncounterBuilder\";\nimport { makeGameNew, makeGameNextLevel, PlayState } from \"./game/playGame\";\nimport { dummyEnemy, randomEnemy, randomPlayer } from \"./game/data\";\nimport { useMachine } from '@xstate/react';\nimport { gameMenuMachine } from \"./stateMachines/menuStateMachine\";\nimport Menu from \"./components/menus/Menu\";\nimport SingleGame from \"./components/menus/SingleGame\";\nimport LoadScreen from \"./components/menus/LoadScreen\";\n\nfunction App() {\n  const [state, send] = useMachine(gameMenuMachine, { devTools: true });\n  const event = state.event;\n  const onMenu = () => {\n    send('MENU');\n  }\n\n  switch (true) {\n    case state.matches('main'):\n      return <Menu\n        title={\"Main Menu\"}\n        states={Object.keys(gameMenuMachine.states.main.on)}\n        onClick={send}\n      />;\n    // QUICK\n    case state.matches({ quick: 'play' }): {\n      const player = randomPlayer();\n      const encounter = randomEnemy();\n      return <SingleGame\n        play={makeGameNew(player[0], player[1], [encounter[0]], [encounter[1]], 50, state.context.singleContext.seed)}\n        onMenu={onMenu}\n        timeTravel={true}\n        onGameEnd={(result, game) => { send(result === 'win' ? 'WIN' : 'LOSE', { result, game }) }}\n      />;\n    }\n    case state.matches({ quick: 'win' }):\n    case state.matches({ quick: 'lose' }):\n      return <Menu\n        title={`${event.result} in ${event.game.states.length - 1} turns`}\n        states={[\"MENU\"]}\n        onClick={send}\n      />;\n    // SINGLE\n    case state.matches({ single: 'player' }):\n      return <PlayerBuilder onSave={(player, playerStats) => { send('PLAYER', { player: [player, playerStats] }); }} />;\n    case state.matches({ single: 'encounter' }):\n      return <EncounterBuilder\n        player={event.player[0]}\n        onSave={(enemies, enemiesStats) => { send('ENCOUNTER', { encounter: [enemies, enemiesStats], player: event.player }) }}\n      />;\n    case state.matches({ single: 'play' }): {\n      return <SingleGame\n        play={makeGameNew(event.player[0], event.player[1], event.encounter[0], event.encounter[1], 50, state.context.singleContext.seed)}\n        onMenu={onMenu}\n        timeTravel={true}\n        onGameEnd={(result, game) => { send(result === 'win' ? 'WIN' : 'LOSE', { result, game }) }}\n      />;\n    }\n    case state.matches({ single: 'win' }):\n    case state.matches({ single: 'lose' }):\n      return <Menu\n        title={`${event.result} in ${event.game.states.length - 1} turns`}\n        states={[\"MENU\"]}\n        onClick={send}\n      />;\n    // TRAINING\n    case state.matches({ training: 'player' }):\n      return <PlayerBuilder onSave={(player, playerStats) => { send('PLAYER', { player: [player, playerStats] }); }} />;\n    case state.matches({ training: 'play' }): {\n      const player = randomPlayer();\n      const encounter = dummyEnemy();\n      return <SingleGame\n        play={makeGameNew(player[0], player[1], [encounter[0]], [encounter[1]], 50, state.context.singleContext.seed)}\n        onMenu={onMenu}\n        timeTravel={true}\n        onGameEnd={(result, game) => { send(result === 'win' ? 'WIN' : 'LOSE', { result, game }) }}\n      />;\n    }\n    case state.matches({ training: 'win' }):\n    case state.matches({ training: 'lose' }):\n      return <Menu\n        title={`You have dealt a lot of damage! Well done `}\n        states={[\"MENU\"]}\n        onClick={send}\n      />;\n    // ARCADE\n    case state.matches({ arcade: 'player' }): {\n      const encounter = randomEnemy();\n      return <PlayerBuilder onSave={(player, playerStats) => { send('PLAYER', { game: makeGameNew(player, playerStats, [encounter[0]], [encounter[1]], 50, state.context.survivalContext.seed) }); }} />;\n    }\n    case state.matches({ arcade: 'play' }): {\n      return <SingleGame\n        play={event.game}\n        timeTravel={false}\n        onMenu={onMenu}\n        onGameEnd={(result: PlayState, game: Play) => {\n          let encounter = [[], []] as [Enemy[], EnemyStats[]];\n          if (state.context.arcadeContext.victories >= 0) {\n            const otherEnemy = randomEnemy();\n            encounter = [[...encounter[0], otherEnemy[0]], [...encounter[1], otherEnemy[1]]];\n          }\n          if (state.context.arcadeContext.victories >= 2) {\n            const otherEnemy = randomEnemy();\n            encounter = [[...encounter[0], otherEnemy[0]], [...encounter[1], otherEnemy[1]]];\n          }\n          if (state.context.arcadeContext.victories >= 5) {\n            const otherEnemy = randomEnemy();\n            encounter = [[...encounter[0], otherEnemy[0]], [...encounter[1], otherEnemy[1]]];\n          }\n          const firstState: Snapshot = game.states[0];\n          send(result === 'win' ? 'WIN' : 'LOSE', { result, game: makeGameNextLevel(game.player, firstState.player, encounter[0] as Enemies, encounter[1] as EnemiesStats, {}, 50, state.context.survivalContext.seed) });\n        }}\n      />;\n    }\n    case state.matches({ arcade: 'victory' }): {\n      return <Menu\n        title={`VICTORY! Final score: ${state.context.arcadeContext.score}`}\n        states={[\"MENU\"]}\n        onClick={send}\n      />;\n    }\n    case state.matches({ arcade: 'defeat' }): {\n      return <Menu\n        title={`Failed after ${state.context.arcadeContext.victories} victories`}\n        states={[\"MENU\"]}\n        onClick={send}\n      />;\n    }\n    // SURVIVAL\n    case state.matches({ survival: 'player' }): {\n      const encounter = randomEnemy();\n      return <PlayerBuilder onSave={(player, playerStats) => { send('PLAYER', { game: makeGameNew(player, playerStats, [encounter[0]], [encounter[1]], 50, state.context.survivalContext.seed) }); }} />;\n    }\n    case state.matches({ survival: 'play' }): {\n      return <SingleGame\n        play={event.game}\n        onMenu={onMenu}\n        timeTravel={false}\n        onGameEnd={(result, game) => {\n          const encounter = randomEnemy();\n          const lastState: Snapshot = game.states[event.game.states.length - 1];\n          send(result === 'win' ? 'WIN' : 'LOSE', { result, game: makeGameNextLevel(game.player, lastState.player, [encounter[0]], [encounter[1]], lastState.inventory, 50, state.context.survivalContext.seed) });\n        }}\n      />;\n    }\n    case state.matches({ survival: 'defeat' }): {\n      return <Menu\n        title={`Completed after ${state.context.survivalContext.victories} victories`}\n        states={[\"MENU\"]}\n        onClick={send}\n      />;\n    }\n    // LOAD\n    case state.matches({ load: 'load' }): {\n      return <LoadScreen\n        onLoad={(game) => send('LOAD', { game })}\n        onMenu={onMenu}\n      />;\n    }\n    case state.matches({ load: 'play' }): {\n      return <SingleGame\n        play={event.game}\n        onMenu={onMenu}\n        timeTravel={true}\n        onGameEnd={(result, game) => { send(result === 'win' ? 'WIN' : 'LOSE', { result, game }) }}\n      />;\n    }\n    case state.matches({ load: 'win' }):\n    case state.matches({ load: 'lose' }):\n      return <Menu\n        title={`${event.result} in ${event.game.states.length - 1} turns`}\n        states={[\"MENU\"]}\n        onClick={send}\n      />;\n    default:\n      return <>{JSON.stringify(state.value)}</>;\n  }\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport { createRoot } from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\nimport reportWebVitals from './reportWebVitals';\n\nconst container = document.getElementById('root');\nconst root = createRoot(container!);\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\nserviceWorkerRegistration.register();\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { Opaque } from \"type-fest\";\nimport { allRanges, enemies, makeStat } from \"./data\";\nimport { updateGlobals } from \"./modding\";\nimport { callEffectFun, Effect, effectFunCall, Enemies, EnemiesStats, Enemy, EnemyStats, FunIndex, MonsterTarget, Play, PlayerStats, Snapshot, Status, Target } from \"./types\";\nimport { clamp, pipe } from \"./zFunDump\";\n\n// #region Effect funs\n\nexport function extractFunction({ effects }: Effect): ReduceFun {\n  return (origin, play, startState) => effects.reduce((acc, { index, parameters }) =>\n    callEffectFun(effectFunRepo, index, parameters)(origin, ...acc), [play, startState]);\n}\n\nconst effectFun = <T>(fun: ParametrizedFun<T>): EffectFun<T> =>\n  ((params) => (origin, play, oldState) => fun(params)(origin, play, oldState)) as EffectFun<T>;\n\nconst applyPoison = (play: Play, currentState: Snapshot, { target, turns }: ReduceFunctionT['Reduce:PoisonBOT']) =>\n  pipe(\n    target === 'Player'\n      ? actions.changeStatPlayer(currentState, ({ hp }) => ({ hp: { ...hp, current: Math.max(0, hp.current - 1) } }))\n      : actions.changeStatMonster(currentState, currentState.target, ({ hp }) => ({ hp: { ...hp, current: Math.max(0, hp.current - 1) } })),\n    (newState) =>\n      turns > 0\n        ? actions.addBotEffect(newState, 'Player', { display: `Poison ${target === 'Player' ? 'Player' : play.enemies[target]!!.lore.name + \"[\" + (target + 1)} + \"]\"`, tooltip: '', range: allRanges, priority: 4, effects: [effectFunCall(['Reduce:PoisonBOT', { target: target, turns: turns - 1 }])] })\n        : newState\n  )\n\ntype SystemFunctionT = {\n  'Utility:Cleanup': undefined;\n  'Debug:GGWP': undefined;\n  'Debug:Sudoku': undefined;\n}\ntype BasicFunctionT = {\n  'Basic:Rest': undefined;\n  'Basic:Move': { amount: number };\n  'Basic:Attack': { amount: number };\n  'Basic:Stamina': { amount: number };\n  'Basic:HP': { amount: number };\n}\nexport type EffectTarget = 'Player' | 'Monster';\ntype StatusFunctionT = {\n  'Effect:Poison': { target: EffectTarget; turns: number };\n  'Effect:Dodge': undefined;\n  'Effect:Armor': { amount: number };\n  'Effect:Stun': undefined;\n  'Effect:Bleed': { target: EffectTarget; turns: number };\n  'Effect:Defence': { target: EffectTarget; amount: number };\n  'Effect:Speed': { target: EffectTarget; amount: number };\n  'Effect:Attack': { target: EffectTarget; amount: number };\n}\ntype MonsterFunctionT = {\n  'Monster:Summon': { enemy: number };\n  'Monster:Dead': undefined;\n  'Monster:Attack': { amount: number };\n  'Monster:Move': { amount: number };\n}\ntype ItemFunctionT = {\n  'Wand:MagicBolt': undefined;\n  'BootsOfFlight:EOT': undefined;\n}\ntype ReduceFunctionT = {\n  'Reduce:PoisonBOT': { target: Target; turns: number };\n}\n\nconst engineFunctions = {\n  'Debug:GGWP': effectFun(\n    () => (_, play, currentState) => [play, { ...currentState, enemies: currentState.enemies.map(m => ({ ...m, hp: { ...m.hp, current: 0 } })) as EnemiesStats }]\n  ),\n  'Debug:Sudoku': effectFun(\n    () => (_, play, currentState) => [play, { ...currentState, player: { ...currentState.player, hp: { ...currentState.player.hp, current: 0 } } }]\n  ),\n  'Utility:Cleanup': effectFun(\n    () => (_origin, play, currentState) => [play,\n      pipe(\n        actions.changeStatusPlayer(currentState, (o) => ({ ...o, armor: { amount: 0 }, bleed: { turns: Math.max(o.bleed.turns - 1, 0) }, dodge: { active: false }, stun: { active: false } })),\n        (newState) =>\n          newState.enemies.reduce((acc, v, idx) => actions.changeStatusMonster(acc, idx as MonsterTarget, (o) => ({ ...o, armor: { amount: 0 }, bleed: { turns: Math.max(o.bleed.turns - 1, 0) }, dodge: { active: false }, stun: { active: false } })), currentState)\n      )\n    ],\n  ),\n}\n\nconst effectFunRepo: EffectFunctionRepository = {\n  ...engineFunctions,\n  // #region BASIC\n  'Basic:Rest': effectFun(\n    () => (_origin, play, currentState) => [play, currentState]\n  ),\n  'Basic:Move': effectFun(\n    ({ amount }) => (_origin, play, currentState) => [play, actions.changeDistance(currentState, currentState.target, amount)]\n  ),\n  'Basic:Attack': effectFun(\n    ({ amount }) => (_origin, play, currentState) => [play, actions.attackMonster(currentState, currentState.target, amount)]\n  ),\n  'Basic:Stamina': effectFun(\n    ({ amount }) => (_origin, play, currentState) => [play, actions.modifyPlayerStamina(currentState, amount)]\n  ),\n  'Basic:HP': effectFun(\n    ({ amount }) => (_origin, play, currentState) => [play, actions.changeStatPlayer(currentState, ({ hp }) => ({ hp: { ...hp, current: clamp(hp.current + amount, 0, hp.max) } }))]\n  ),\n  // #endregion BASIC\n  // #region EFFECTS\n  'Effect:Dodge': effectFun(\n    () => (origin, play, currentState) => [play,\n      origin === 'Player'\n        ? actions.changeStatusPlayer(currentState, (o) => ({ ...o, dodge: { active: true } }))\n        : actions.changeStatusMonster(currentState, currentState.target, (o) => ({ ...o, dodge: { active: true } }))\n    ]\n  ),\n  'Effect:Armor': effectFun(\n    ({ amount }) => (origin, play, currentState) => [play,\n      origin === 'Player'\n        ? actions.changeStatusPlayer(currentState, (o) => ({ ...o, armor: { amount: amount } }))\n        : actions.changeStatusMonster(currentState, currentState.target, (o) => ({ ...o, armor: { amount: amount } }))\n    ]\n  ),\n  'Effect:Stun': effectFun(\n    () => (origin, play, currentState) => [play,\n      origin === 'Player'\n        ? actions.changeStatusMonster(currentState, currentState.target, (o) => ({ ...o, stun: { active: true } }))\n        : actions.changeStatusPlayer(currentState, (o) => ({ ...o, stun: { active: true } }))\n    ]\n  ),\n  'Effect:Bleed': effectFun(\n    ({ target, turns }) => (_, play, currentState) => [play,\n      target !== 'Player'\n        ? actions.changeStatusPlayer(currentState, (o) => ({ ...o, bleed: { turns: turns } }))\n        : actions.changeStatusMonster(currentState, currentState.target, (o) => ({ ...o, bleed: { turns: turns } }))\n    ]\n  ),\n  'Effect:Poison': effectFun(\n    ({ target, turns }) => (_, play, currentState) => [play,\n      pipe(target === 'Player' ? 'Player' as Target : currentState.target, (gameTarget) =>\n        applyPoison(play, currentState, { target: gameTarget, turns })\n      )\n    ],\n  ),\n  'Reduce:PoisonBOT': effectFun(\n    (params) => (_, play, currentState) =>\n      [play, applyPoison(play, currentState, params)],\n  ),\n  'Effect:Attack': effectFun(\n    ({ target, amount }) => (_, play, currentState) => [play,\n      target === 'Player'\n        ? actions.changeStatPlayer(currentState, ({ attack }) => ({ attack: { ...attack, current: Math.min(attack.current + amount, attack.max) } }))\n        : actions.changeStatMonster(currentState, currentState.target, ({ attack }) => ({ attack: { ...attack, current: Math.min(attack.current + amount, attack.max) } }))\n    ]\n  ),\n  'Effect:Speed': effectFun(\n    ({ target, amount }) => (_, play, currentState) => [play,\n      target === 'Player'\n        ? actions.changeStatPlayer(currentState, ({ speed }) => ({ speed: { ...speed, current: Math.min(speed.current + amount, speed.max) } }))\n        : actions.changeStatMonster(currentState, currentState.target, ({ speed }) => ({ speed: { ...speed, current: Math.min(speed.current + amount, speed.max) } }))\n    ]\n  ),\n  'Effect:Defence': effectFun(\n    ({ target, amount }) => (_, play, currentState) => [play,\n      target === 'Player'\n        ? actions.changeStatPlayer(currentState, ({ defence }) => ({ defence: { ...defence, current: Math.min(defence.current + amount, defence.max) } }))\n        : actions.changeStatMonster(currentState, currentState.target, ({ defence }) => ({ defence: { ...defence, current: Math.min(defence.current + amount, defence.max) } }))\n    ]\n  ),\n  // #endregion EFFECTS\n  // #region MONSTERS\n  'Monster:Attack': effectFun(\n    ({ amount }) => (_origin, play, currentState) => [play, actions.attackPlayer(currentState, amount)]\n  ),\n  'Monster:Summon': effectFun(\n    ({ enemy }) => (_origin, play, currentState) => actions.addEnemy(play, currentState, enemies[enemy][0], enemies[enemy][1])\n  ),\n  'Monster:Dead': effectFun(\n    () => (_origin, play, currentState) => [play, currentState]\n  ),\n  'Monster:Move': effectFun(\n    () => (origin, play, currentState) => [play, actions.changeDistance(currentState, origin, -2)]\n  ),\n  // #endregion MONSTERS\n  // #region ITEMS\n  'BootsOfFlight:EOT': effectFun(\n    () => (_, play, currentState) => [play, currentState.enemies.reduce((s, _m, idx) => actions.changeDistance(s, idx as MonsterTarget, 2), currentState)]\n  ),\n  'Wand:MagicBolt': effectFun(\n    () => (_, play, currentState) => {\n      let state = currentState;\n      while (state.player.stamina.current) {\n        state = actions.modifyPlayerStamina(state, -2);\n        state = actions.attackMonster(state, currentState.target, 1)\n      }\n      return [play, state];\n    }\n  ),\n  // #endregion ITEMS\n};\n\nexport type EffectFunctionT = SystemFunctionT & BasicFunctionT & StatusFunctionT & ReduceFunctionT & MonsterFunctionT & ItemFunctionT;\n\nexport type ReduceFun = (origin: Target, play: Play, newState: Snapshot) => [Play, Snapshot];\nexport type ParametrizedFun<T> = (params: T) => ReduceFun;\nexport type EffectFun<T> = Opaque<ParametrizedFun<T>, ParametrizedFun<T>>;\n\nexport type EffectFunctionRepository = { [k in keyof EffectFunctionT]: (params: EffectFunctionT[k]) => ReduceFun };\nexport type EffectFunRepoIndex = keyof EffectFunctionT & FunIndex;\nexport type EffectFunParams<T extends EffectFunRepoIndex> = Parameters<EffectFunctionRepository[T]>[0];\n\n// #endregion\n// #region Modify state\n\nconst updateMonster = (enemies: EnemiesStats, target: Target, override: (stats: EnemyStats) => Partial<EnemyStats>): EnemiesStats =>\n  enemies.map((m, idx) =>\n    (idx === target)\n      ? { ...m, ...override(m) }\n      : m) as EnemiesStats;\n\nconst updatePlayer = (curr: Snapshot, override: (player: PlayerStats) => Partial<PlayerStats>): Snapshot => {\n  return {\n    ...curr,\n    player: { ...curr.player, ...override(curr.player) }\n  };\n}\n\nconst updatePlayerStat = <T extends keyof PlayerStats>(curr: Snapshot, key: T, modify: (player: PlayerStats[T]) => Partial<PlayerStats[T]>): Snapshot => {\n  const player = curr.player;\n  player[key] = {\n    ...player[key],\n    ...modify(player[key])\n  }\n  return {\n    ...curr,\n    player\n  };\n}\n\nconst actions = {\n  attackPlayer,\n  attackMonster,\n  changeStatPlayer: updatePlayer,\n  changeStatMonster: (curr: Snapshot, target: MonsterTarget, f: (stats: EnemyStats) => Partial<EnemyStats>): Snapshot => ({\n    ...curr,\n    enemies: updateMonster(curr.enemies, target, f),\n  }),\n  changeStatusPlayer: (curr: Snapshot, updateStatus: (oldStatus: Status) => Status): Snapshot => ({\n    ...curr,\n    player: { ...curr.player, status: updateStatus(curr.player.status) }\n  }),\n  changeStatusMonster: (curr: Snapshot, target: MonsterTarget, updateStatus: (oldStatus: Status) => Status): Snapshot => ({\n    ...curr,\n    enemies: updateMonster(curr.enemies, target, ({ status }) => ({ status: updateStatus(status) })),\n  }),\n  changeDistance: (curr: Snapshot, origin: Target, amount: number): Snapshot =>\n  ({\n    ...curr,\n    enemies: updateMonster(curr.enemies, origin, ({ distance }) => ({ distance: clamp(distance + amount, 0, 4) as MonsterTarget })),\n  }),\n  removeMonster: (currPlay: Play, currSnap: Snapshot, target: MonsterTarget): [Play, Snapshot] =>\n    [\n      { ...currPlay, enemies: currPlay.enemies.filter((_, idx) => idx === target) as Enemies },\n      { ...currSnap, target: 0, enemies: currSnap.enemies.filter((_, idx) => idx === target) as EnemiesStats }\n    ],\n  modifyPlayerStamina: (\n    curr: Snapshot,\n    amount: number,\n  ): Snapshot =>\n    updatePlayerStat(curr, 'stamina', stamina => ({\n      current: clamp(stamina.current + amount, 0, stamina.max)\n    })),\n  addEotEffect: (\n    curr: Snapshot,\n    origin: Target,\n    effect: Effect,\n  ): Snapshot => ({\n    ...curr,\n    eot: [...(curr.eot ?? []), [origin, effect]],\n  }),\n  addBotEffect: (\n    curr: Snapshot,\n    origin: Target,\n    effect: Effect,\n  ): Snapshot => ({\n    ...curr,\n    bot: [...(curr.eot ?? []), [origin, effect]],\n  }),\n  addEnemy: (\n    play: Play,\n    curr: Snapshot,\n    enemy: Enemy,\n    enemyStats: EnemyStats,\n  ): [Play, Snapshot] => {\n    return play.enemies.length < 5\n      ? [{\n        ...play,\n        enemies: [...play.enemies, enemy] as Enemies,\n      }, {\n        ...curr,\n        enemies: [...curr.enemies, enemyStats] as EnemiesStats,\n      }]\n      : [play, curr];\n  }\n};\n\nfunction attackMonster(curr: Snapshot, target: MonsterTarget, amount: number): Snapshot {\n  const monster = curr.enemies[target]!!;\n  const armor = monster.status.armor.amount;\n  const damage = amount + curr.player.attack.current;\n  const afterDefence = Math.max(damage - monster.defence.current, 0);\n  const afterArmor = Math.max(afterDefence - armor, 0);\n  const armorSpent = armor - (afterDefence - afterArmor);\n  const afterBleed = afterArmor + (monster.status.bleed.turns > 0 ? 1 : 0);\n  return ({\n    ...curr,\n    enemies: updateMonster(curr.enemies, target, ({ status, hp }) => ({\n      hp: { max: hp.max, current: clamp(hp.current - afterBleed, 0, hp.max) },\n      status:\n        { ...status, armor: { amount: armorSpent } }\n    })),\n  });\n}\n\nfunction attackPlayer(curr: Snapshot, amount: number): Snapshot {\n  const armor = curr.player.status.armor.amount;\n  const damage = amount + curr.player.attack.current;\n  const afterDefence = Math.max(damage - curr.player.defence.current, 0);\n  const afterArmor = Math.max(afterDefence - armor, 0);\n  const armorSpent = armor - (afterDefence - afterArmor);\n  const afterBleed = afterArmor + (curr.player.status.bleed.turns > 0 ? 1 : 0);\n  return updatePlayer(curr, ({ hp, status }) => ({\n    hp: { max: hp.max, current: clamp(hp.current - afterBleed, 0, hp.max) },\n    status: { ...status, armor: { amount: status.armor.amount - armorSpent } }\n  }));\n}\n\n// #endregion\n// #region Stat funs\n\nexport type StatsFunIndex = keyof typeof statsRepository;\nexport const statsRepository = {\n  '+Health': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, hp: makeStat(player.hp.current + 3) }, enemies],\n  '+StaPerTurn': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, staminaPerTurn: makeStat(player.staminaPerTurn.current + 1) }, enemies],\n  '+Stamina': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, stamina: makeStat(player.stamina.current + 2) }, enemies],\n  '+Attack': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, attack: makeStat(player.attack.current + 1) }, enemies],\n  '+Speed': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, speed: makeStat(player.speed.current + 1) }, enemies],\n  '+Defence': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, defence: makeStat(player.defence.current + 1) }, enemies],\n\n  '-Health': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, hp: makeStat(player.hp.current - 3) }, enemies],\n  '-StaPerTurn': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, staminaPerTurn: makeStat(player.staminaPerTurn.current - 1) }, enemies],\n  '-Stamina': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, stamina: makeStat(player.stamina.current - 2) }, enemies],\n  '-Attack': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, attack: makeStat(player.attack.current - 1) }, enemies],\n  '-Speed': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, speed: makeStat(player.speed.current - 1) }, enemies],\n  '-Defence': (player: PlayerStats, enemies: EnemiesStats): [PlayerStats, EnemiesStats] => [{ ...player, defence: makeStat(player.defence.current - 1) }, enemies],\n}\n\n// #endregion\n\nupdateGlobals({ effects: effectFunRepo });\n","import { Enemies, Player, Snapshot, MonsterTarget, Target, InventoryEffect, EnemiesStats, PlayerStats, Play, RNG, StatsFun, Effect, PlayerTarget, effectFunCall, DisabledSkills, safeEntries, EffectPhase, InventoryStats, Seed } from \"./types\";\nimport { Seq, Set } from \"immutable\";\nimport { allRanges, previousState } from \"./data\";\nimport { Chance } from \"chance\";\n// @ts-ignore fails on scripts despite having a d.ts file\nimport { toIndexableString } from 'pouchdb-collate';\nimport { extractFunction, statsRepository } from \"./effectRepository\";\nimport { clamp, rangeArr } from \"./zFunDump\";\n\n/**\n * @returns min inclusive, max exclusive rand\n */\nfunction turnDeterministicRng(turns: number, randPerTurn: number, monsterSeed: Seed): RNG {\n  const monsterChance = new Chance(monsterSeed);\n  const monsterRng =\n    rangeArr(turns)\n      .map(_ => rangeArr(randPerTurn)\n        .map(_ => monsterChance.floating({ min: 0, max: 1, fixed: 2 })));\n  return monsterRng as RNG;\n}\n\nexport const turnRng = (play: Play, turn: number): ((min: number, max: number) => number) => {\n  const turnRng = [...play.rng[turn]];\n  return (min: number, max: number) => Math.ceil(((max - min) * turnRng.pop()!!) + min) - 1;\n}\n\nexport const playerPassives = (player: Player): StatsFun[] =>\n  safeEntries(player.build).flatMap(([_k, s]) => s.passives ?? []).map(i => statsRepository[i]);\n\nexport const playerActions = (player: Player, inventoryStats: InventoryStats): InventoryEffect[] =>\n  safeEntries(player.build)\n    .flatMap(([_k, i]) => (i.effects ?? []))\n    .filter(e => (e.amount ?? 999) > (inventoryStats[e.display]?.used ?? 0));\n\nconst enemiesBotEffects = (enemies: Enemies): [MonsterTarget, Effect][] =>\n  enemies.flatMap((e, idx) => (e.bot ?? []).map(eff => [idx as MonsterTarget, eff] as const))\n    // Sure, typescript\n    .map(a => [...a]);\n\nconst enemiesEotEffects = (enemies: Enemies): [MonsterTarget, Effect][] =>\n  enemies.flatMap((e, idx) => (e.eot ?? []).map(eff => [idx as MonsterTarget, eff] as const))\n    // Sure, typescript\n    .map(a => [...a]);\n\nexport const playerBotEffects = (player: Player, d: DisabledSkills): [PlayerTarget, Effect][] =>\n  safeEntries(player.build).flatMap(([k, s]) => !Set(d).has(k) ? s.bot ?? [] : []).map(a => ['Player', a]);\n\nexport const playerEotEffects = (player: Player, d: DisabledSkills): [PlayerTarget, Effect][] =>\n  safeEntries(player.build).flatMap(([k, s]) => !Set(d).has(k) ? s.eot ?? [] : []).map(a => ['Player', a]);\n\nexport const buildPlayer = (player: Player, playerStats: PlayerStats, enemiesStats: EnemiesStats): [PlayerStats, EnemiesStats] =>\n  playerPassives(player).reduce(([p, e], fun) => fun(p, e), [playerStats, enemiesStats]);\n\nexport function makeGameNew(player: Player, playerStats: PlayerStats, enemies: Enemies, enemiesStats: EnemiesStats, turns: number, seed: number | string, randPerTurn: number = 20): Play {\n  const [playerGameStats, enemyGameStats] = buildPlayer(player, playerStats, enemiesStats);\n  return makeGameNextLevel(player, playerGameStats, enemies, enemyGameStats, {}, turns, seed, randPerTurn);\n}\n\nexport function makeGameNextLevel(player: Player, playerStats: PlayerStats, enemies: Enemies, enemiesStats: EnemiesStats, inventoryStats: InventoryStats, turns: number, seed: number | string, randPerTurn: number = 20): Play {\n  return {\n    player,\n    enemies,\n    states: [{\n      player: playerStats,\n      enemies: enemiesStats,\n      inventory: inventoryStats,\n      target: 0,\n      lastAttacks: [],\n      disabledSkills: []\n    }],\n    rng: turnDeterministicRng(turns, randPerTurn, seed),\n    turns,\n    id: toIndexableString([player, enemies, turns, seed]),\n    seed,\n    version: \"1\",\n  };\n}\n\nconst reduceFuns = (funs: [Target, Effect][], p: Play, s: Snapshot, dodgeable: boolean, phase: EffectPhase): [Play, Snapshot] =>\n  Seq(funs)\n    .sortBy(([origin, a]) => {\n      if (a == null) {\n        throw new Error(`Error in ${phase} by ${origin === 'Player' ? 'Player' : p.enemies[origin]?.lore.name}`);\n      }\n      const priorityBonus = origin === 'Player' ? s.player.speed.current : s.enemies[origin]!!.speed.current;\n      return clamp(a.priority - priorityBonus, 0, 4);\n    })\n    .reduce((acc, value) => {\n      const [origin, effect] = value;\n      const [oldPlay, oldState] = acc;\n      const monsterId = origin === 'Player' ? oldState.target : origin;\n      const targetMonster = oldState.enemies[monsterId]!!;\n\n      const isDeadAttackingMonster = origin !== 'Player' && targetMonster.hp.current <= 0;\n      if (isDeadAttackingMonster) {\n        const newState: Snapshot = {\n          ...oldState,\n          lastAttacks: [...oldState.lastAttacks, { origin, display: `DEAD ${effect.display}`, phase }]\n        };\n        return [oldPlay, newState];\n      }\n\n      const isStunnedPlayer = origin === 'Player' && oldState.player.status.stun.active;\n      const isStunnedMonster = origin !== 'Player' && targetMonster.status.stun.active;\n      const isStunned = isStunnedPlayer || isStunnedMonster;\n      if (isStunned) {\n        const newState: Snapshot = {\n          ...oldState,\n          lastAttacks: [...oldState.lastAttacks, { origin, display: `STUNNED ${effect.display}`, phase }]\n        };\n        return [oldPlay, newState];\n      }\n\n\n      const isInRange = Set([...effect.range]).has(targetMonster.distance);\n      if (!isInRange) {\n        const newState: Snapshot = {\n          ...oldState,\n          lastAttacks: [...oldState.lastAttacks, { origin, display: `WHIFFED ${effect.display}`, phase }]\n        };\n        return [oldPlay, newState];\n      }\n\n      const monsterDodged = dodgeable && origin === 'Player' && targetMonster.status.dodge.active;\n      if (monsterDodged) {\n        const newState: Snapshot = {\n          ...oldState,\n          enemies: oldState.enemies.map((e, i) => i === monsterId ? { ...e, status: { ...e.status, dodge: { active: false } } } : e) as EnemiesStats,\n          lastAttacks: [...oldState.lastAttacks, { origin, display: `DODGED ${effect.display}`, phase }]\n        };\n        return [oldPlay, newState];\n      }\n\n      const playerDodged = dodgeable && origin !== 'Player' && oldState.player.status.dodge.active;\n      if (playerDodged) {\n        const newState: Snapshot = {\n          ...oldState,\n          player: { ...oldState.player, status: { ...oldState.player.status, dodge: { active: false } } },\n          lastAttacks: [...oldState.lastAttacks, { origin, display: `DODGED ${effect.display}`, phase }]\n        };\n        return [oldPlay, newState];\n      }\n\n      const [newPlay, newState] = extractFunction(effect)(origin, oldPlay, oldState);\n      const finalState: Snapshot = { ...newState, lastAttacks: [...newState.lastAttacks, { origin, display: effect.display, phase }] };\n      return [newPlay, finalState];\n    }, [p, s]);\n\nconst applyEffectStamina = (amount: number): Effect =>\n  ({ display: `${amount >= 0 ? '+' : ''}${amount} `, tooltip: `Use ${amount} stamina`, effects: [effectFunCall(['Basic:Stamina', { amount }])], range: allRanges, priority: 0 });\n\nconst effectEotCleanup: Effect =\n  ({ display: 'Cleanup', tooltip: 'Cleanup', effects: [effectFunCall('Utility:Cleanup')], range: allRanges, priority: 0 });\n\nconst effectDead: Effect =\n  { display: \"\", tooltip: \"\", priority: 4, effects: [effectFunCall(\"Monster:Dead\")], range: allRanges };\n\nexport const handlePlayerEffect = (play: Play, index: number): Play => {\n\n  const lastTurnState = previousState(play);\n  const usedSkill = playerActions(play.player, lastTurnState.inventory)[index];\n  const bot = lastTurnState.bot ?? [];\n  const eot = lastTurnState.eot ?? [];\n\n  const initialState: Snapshot = {\n    ...lastTurnState,\n    lastAttacks: [],\n    bot: undefined,\n    eot: undefined,\n    inventory: {\n      ...lastTurnState.inventory,\n      [usedSkill.display]: {\n        used: 1 + (lastTurnState.inventory[usedSkill.display]?.used ?? 0)\n      }\n    }\n  };\n\n  // Stamina\n  const [preBotPlay, preBotState] =\n    reduceFuns([['Player', applyEffectStamina(lastTurnState.player.staminaPerTurn.current - usedSkill.stamina)]], play, initialState, false, 'MAIN');\n\n  // BOT\n  // Lingering effects\n  const [postBotPlay, postBotState] = reduceFuns(bot, preBotPlay, preBotState, false, 'BOT');\n  // Player & Monster effects\n  const entitiesBot: [Target, Effect][] = [...playerBotEffects(postBotPlay.player, postBotState.disabledSkills), ...enemiesBotEffects(postBotPlay.enemies)];\n  const [postEntitiesBotPlay, postEntitiesBotState] = reduceFuns(entitiesBot, postBotPlay, postBotState, false, 'BOT');\n\n  // Turn\n  const rand = turnRng(postEntitiesBotPlay, postEntitiesBotPlay.states.length);\n  const turnFunctions: [Target, Effect][] = Seq(postEntitiesBotPlay.enemies).zip(Seq(postEntitiesBotState.enemies))\n    .map(([e, stats], idx) => {\n      if (stats.hp.current > 0) {\n        return [idx as Target, effectDead] as const;\n      } else {\n        const rolls = e.rolls[stats.distance];\n        const roll = rand(0, e.rolls[stats.distance].length);\n        // if (isNaN(roll)) {\n        //   throw new Error('Out of RNG exception');\n        // }\n        const effect = e.effects[rolls[roll]];\n        // if (effect == null) {\n        //   throw new Error(`Rolled outside the table ${JSON.stringify({ roll, rolls, effects: e.effects })}`);\n        // }\n        return [idx as Target, effect] as const;\n      }\n    })\n    .concat([['Player' as Target, usedSkill] as const])\n    .toArray()\n    // Sure, typescript\n    .map(a => [...a]);\n\n  const [newPlay, newState] =\n    reduceFuns(turnFunctions, postEntitiesBotPlay, postEntitiesBotState, true, 'MAIN');\n\n  // EOT\n  // Player & Monster effects\n  const entitiesEot = [...playerEotEffects(newPlay.player, newState.disabledSkills), ...enemiesEotEffects(newPlay.enemies)];\n  const [postPlayerEotPlay, postPlayerEotState] = reduceFuns(entitiesEot, newPlay, newState, false, 'EOT');\n  // Lingering effects\n  const [postEotPlay, postEotState] = reduceFuns(eot, postPlayerEotPlay, postPlayerEotState, false, 'EOT');\n  // Cleanup\n  const [postCleanup, postCleanupState] = reduceFuns([['Player' as Target, effectEotCleanup]], postEotPlay, postEotState, false, 'EOT');\n\n  const endOfTurn: Play = {\n    ...postCleanup,\n    states: [...postCleanup.states, postCleanupState],\n  };\n\n  return endOfTurn;\n};\n\nexport const setSelected = (play: Play, target: MonsterTarget): Play => {\n  play.states[play.states.length - 1].target = target;\n  return {\n    ...play,\n    states: [...play.states],\n  };\n}\n\nexport const setDisabledSkills = (play: Play, disabled: DisabledSkills): Play => {\n  play.states[play.states.length - 1].disabledSkills = disabled;\n  return {\n    ...play,\n    states: [...play.states],\n  };\n}\n\nexport type PlayState = 'win' | 'loss' | 'playing'\n\nexport const playState = (play: Play): PlayState => {\n  const state = play.states[play.states.length - 1];\n  return state.player.hp.current <= 0\n    ? 'loss'\n    : state.enemies.reduce((acc, monster) => acc + monster.hp.current, 0) <= 0\n      ? 'win'\n      : 'playing';\n}\n\nexport const scoreGame = (play: Play): number => {\n  const firstState = play.states[0];\n  const lastState = play.states[play.states.length - 1];\n\n  const turns = play.states.length; // 1-50\n  const hpLoss = Math.max(0, firstState.player.hp.max - lastState.player.hp.current) / firstState.player.hp.max; // 0-1\n  const staminaLoss = Math.max(0, firstState.player.stamina.max - lastState.player.stamina.current) / firstState.player.hp.max; // 0-1\n  const enemies = lastState.enemies.length; // 1-5\n\n  return Math.floor(enemies * ((500 * hpLoss) + (150 * staminaLoss) + (500 - (turns * 10))));\n}\n","export const rangeArr = (max: number, min: number = 0) => {\n  let range = [...Array(max).keys()];\n  if (min >= 0) {\n    range.filter(i => i < min)\n  }\n  return range;\n}\n\nexport const clamp = (num: number, min: number, max: number = Infinity) =>\n  Math.min(Math.max(num, min), max);\n\nexport const pipe = <T, U>(t: T, f: (t: T) => U): U =>\n  f(t)\n\nexport const pipe2 = <T, U, A>(t: T, u: U, f: (t: T, u: U) => A): A =>\n  f(t, u)\n\nexport const pipe3 = <T, U, V, A>(t: T, u: U, v: V, f: (t: T, u: U, v: V) => A): A =>\n  f(t, u, v)","import { EffectFunctionRepository } from \"./effectRepository\";\nimport { BuildRepository, effectFunCall, Enemy, EnemyInfo, EnemyRepository, EnemyStats, Play } from \"./types\";\n\nexport type Globals = {\n  debug: boolean;\n  trainingEnemy: EnemyInfo;\n  build?: BuildRepository;\n  effects?: EffectFunctionRepository;\n  enemies?: EnemyRepository;\n  ingame?: {\n    game: Play;\n    forceUpdate: () => void;\n  }\n};\n\nconst globalsDefault: Globals = {\n  debug: false,\n  trainingEnemy: [{\n    lore: {\n      name: \" Dummy \",\n    },\n    effects: [\n      {\n        display: \"Approve of your life choices\",\n        tooltip: \"You're doing great!\",\n        priority: 4,\n        effects: [effectFunCall([\"Monster:Attack\", { amount: 0 }])],\n        range: []\n      },\n    ],\n    rolls: [\n      [0],\n      [0],\n      [0],\n      [0],\n      [0],\n    ]\n  }, {\n    hp: { current: 300, max: 300 },\n    distance: 0,\n    speed: { current: 0, max: 0 },\n    attack: { current: 0, max: 0 },\n    defence: { current: 0, max: 0 },\n    status: {\n      dodge: { active: false },\n      armor: { amount: 0 },\n      bleed: { turns: 0 },\n      stun: { active: false },\n    },\n  }],\n}\n\nexport const globals = (): Globals =>\n  // @ts-ignore\n  globalThis.__buildmancer;\n\nexport const updateGlobals = (p: Partial<Globals>) => {\n  const theThis = (globalThis as unknown) as { __buildmancer: Globals };\n  theThis.__buildmancer = ({\n    ...globalsDefault,\n    ...(theThis.__buildmancer ?? {}),\n    ...p,\n  });\n}\n\nupdateGlobals({});\n","import { Opaque } from \"type-fest\";\nimport { EffectFunParams, EffectFunctionRepository, EffectFunRepoIndex, StatsFunIndex } from \"./effectRepository\";\n\nexport type Tuple<T, N extends number> = N extends N ? number extends N ? T[] : _TupleOf<T, N, []> : never;\ntype _TupleOf<T, N extends number, R extends unknown[]> = R['length'] extends N ? R : _TupleOf<T, N, [T, ...R]>;\n\nexport type Nel<T> = [T, ...T[]];\n\ntype Length<T extends any[]> =\n  T extends { length: infer L } ? L : never;\ntype BuildTuple<L extends number, T extends any[] = []> =\n  T extends { length: L } ? T : BuildTuple<L, [...T, any]>;\nexport type Subtract<A extends number, B extends number> =\n  BuildTuple<A> extends [...(infer U), ...BuildTuple<B>]\n  ? Length<U>\n  : never;\ntype EQ<A, B> =\n  A extends B\n  ? (B extends A ? true : false)\n  : false;\ntype AtTerminus<A extends number, B extends number> =\n  A extends 0\n  ? true\n  : (B extends 0 ? true : false);\ntype LT<A extends number, B extends number> =\n  AtTerminus<A, B> extends true\n  ? EQ<A, B> extends true\n  ? false\n  : (A extends 0 ? true : false)\n  : LT<Subtract<A, 1>, Subtract<B, 1>>;\n\nexport type TupleUpTo<T, N extends number> =\n  EQ<N, 1> extends true ? [T] : TupleUpTo<T, Subtract<N, 1>> | Tuple<T, N>;\n\nexport type UpTo<N extends number> =\n  EQ<N, 0> extends true ? 0 : UpTo<Subtract<N, 1>> | N;\n\nexport interface Stat {\n  max: number,\n  current: UpTo<Stat['max']>,\n}\n\nexport type Status = {\n  dodge: { active: boolean },\n  stun: { active: boolean },\n  armor: { amount: number },\n  bleed: { turns: number }\n};\nexport interface PlayerStats {\n  hp: Stat,\n  stamina: Stat,\n  staminaPerTurn: Stat,\n  speed: Stat,\n  attack: Stat,\n  defence: Stat,\n  status: Status\n};\nexport interface EnemyStats {\n  hp: Stat,\n  speed: Stat,\n  attack: Stat,\n  defence: Stat,\n  distance: UpTo<Subtract<Distances, 1>>,\n  status: Status\n};\nexport type InventoryStats = {\n  [k in Item['display']]: { used: number }\n};\n\nexport type Priorities = 5;\nexport type Distances = 5;\nexport type MonsterCount = 5;\nexport type Staminas = 10;\n\nexport type EffectPhase = 'MAIN' | 'EOT' | 'BOT';\nexport interface EffectSummary {\n  origin: Target;\n  display: string;\n  phase: EffectPhase;\n}\n\nexport type DisabledSkills = (keyof BuildRepository)[];\nexport interface Snapshot {\n  player: PlayerStats;\n  enemies: EnemiesStats;\n  inventory: InventoryStats;\n  target: MonsterTarget;\n  lastAttacks: EffectSummary[];\n  bot?: Nel<[Target, Effect]>;\n  eot?: Nel<[Target, Effect]>;\n  disabledSkills: DisabledSkills;\n};\n\nexport type RNG = Opaque<number[][], 'RNG'>;\n\nexport type VersionString = \"1\";\nexport type Seed = number | string;\nexport interface Play {\n  states: Nel<Snapshot>;\n  player: Player;\n  enemies: Enemies,\n  rng: RNG;\n  turns: number;\n  id: string;\n  seed: Seed;\n  version: VersionString;\n};\n\ntype ItemOrMonster = string /* TODO all items */ | 'Monster';\nexport type FunIndex = `${ItemOrMonster}:${string}`;\n\nexport type StatsFunRepo = { [key in StatsFunIndex]: StatsFun; }\nexport type StatsFun = (player: PlayerStats, enemies: EnemiesStats) => [PlayerStats, EnemiesStats];\n\nexport type Ranges = UpTo<Subtract<Distances, 1>>[];\n\ninterface EffectFunCallT {\n  index: EffectFunRepoIndex;\n  parameters: EffectFunParams<EffectFunRepoIndex>;\n};\nexport type EffectFunCall = Opaque<EffectFunCallT, EffectFunCallT>;\nexport const effectFunCall = <T extends EffectFunRepoIndex>(t: EffectFunParams<T> extends undefined ? T : [T, EffectFunParams<T>]): EffectFunCall =>\n  (Array.isArray(t) ? { index: t[0], parameters: t[1] } : { index: t, parameters: undefined }) as EffectFunCall;\nexport const callEffectFun = <T extends EffectFunRepoIndex>(repo: EffectFunctionRepository, t: T, p: EffectFunParams<T>) => {\n  const f = repo[t];\n  // @ts-expect-error: index and parameters are enforced to be compatible at construction and the runtime check above ^^^^\n  return f(p);\n}\n\nexport interface Effect {\n  display: string;\n  tooltip: string;\n  effects: Nel<EffectFunCall>;\n  priority: UpTo<Subtract<Priorities, 1>>;\n  range: Ranges;\n};\nexport interface InventoryEffect extends Effect {\n  stamina: UpTo<Subtract<Staminas, 1>>;\n  amount?: number;\n};\n\nexport type MonsterTarget = UpTo<Subtract<MonsterCount, 1>>;\nexport type PlayerTarget = 'Player';\nexport type Target = MonsterTarget | PlayerTarget;\n\nexport interface BuildRepository {\n  debug: Item[];\n  basic: Item[];\n  class: Item[];\n  skill: Item[];\n  weapon: Item[];\n  offhand: Item[];\n  consumable: Item[];\n  armor: Item[];\n  headgear: Item[];\n  footwear: Item[];\n  charm: Item[];\n}\nexport type Build = {\n  [k in keyof BuildRepository]: Item\n};\n\nexport type EnemyInfo = [Enemy, EnemyStats];\nexport type EnemyRepository = EnemyInfo[];\n\nexport interface Item {\n  display: string;\n  tooltip?: string;\n  passives?: StatsFunIndex[];\n  bot?: Nel<Effect>;\n  eot?: Nel<Effect>;\n  effects?: Nel<InventoryEffect>;\n  //[key: string]: any;\n};\n\nexport interface Player {\n  id: string;\n  lore: Record<string, string | number>;\n  build: Build;\n};\n\n// Place in the array for now\ntype EffectIdentity = number;\nexport interface Enemy {\n  lore: Record<string, string | number>;\n  effects: Nel<Effect>;\n  rolls: Tuple<EffectIdentity[], Distances>;\n  bot?: Nel<Effect>;\n  eot?: Nel<Effect>;\n}\n\nexport type Enemies = TupleUpTo<Enemy, MonsterCount>;\nexport type EnemiesStats = TupleUpTo<EnemyStats, MonsterCount>;\n\nexport const safeEntries = <T, K extends keyof T>(o: {\n  [s in K]: T[s];\n}): [K, T[K]][] =>\n  Object.entries(o).map(([k, v]) => [k as K, v as T[K]]);\n","import WebSocket from 'ws';\nimport { assign, createMachine, interpret } from 'xstate';\nimport { inspect } from '@xstate/inspect/lib/server.js';\nimport { scoreGame } from '../game/playGame';\n\nconst isDebug = process && process.env['SMD'] === '1';\n\nif (isDebug) {\n  inspect({\n    server: new WebSocket.Server({\n      port: 8888\n    })\n  });\n}\n\nconst toMenu = {\n  on: {\n    MENU: { target: 'main' },\n  }\n}\n\nconst quick = {\n  initial: 'play',\n  states: {\n    play: {\n      entry: ['reset'],\n      on: {\n        WIN: { target: 'win' },\n        LOSE: { target: 'lose' }\n      }\n    },\n    win: { type: 'final' as const },\n    lose: { type: 'final' as const },\n  },\n  ...toMenu,\n};\n\nconst single = {\n  initial: 'player',\n  states: {\n    player: {\n      entry: ['reset'],\n      on: {\n        PLAYER: { target: 'encounter' }\n      }\n    },\n    encounter: {\n      on: {\n        ENCOUNTER: { target: 'play' }\n      }\n    },\n    play: {\n      on: {\n        WIN: { target: 'win' },\n        LOSE: { target: 'lose' }\n      }\n    },\n    win: { type: 'final' as const },\n    lose: { type: 'final' as const },\n  },\n  ...toMenu,\n};\n\nconst arcade = {\n  initial: 'player',\n  states: {\n    player: {\n      entry: ['reset'],\n      on: {\n        PLAYER: { target: 'play' }\n      }\n    },\n    play: {\n      on: {\n        WIN: [\n          { target: 'victory', cond: 'isFinal' },\n          { target: 'play', actions: ['bumpVictories', 'bumpScore'], internal: true },\n        ],\n        LOSE: { target: 'defeat' }\n      }\n    },\n    victory: {\n      type: 'final' as const,\n    },\n    defeat: {\n      type: 'final' as const,\n    },\n  },\n  ...toMenu,\n};\n\nconst survival = {\n  initial: 'player',\n  states: {\n    player: {\n      entry: ['reset'],\n      on: {\n        PLAYER: { target: 'play' }\n      }\n    },\n    play: {\n      on: {\n        WIN: { target: 'play', actions: ['bumpVictories'] },\n        LOSE: { target: 'defeat' }\n      }\n    },\n    defeat: {\n      type: 'final' as const,\n      on: {\n        // ACK: { target: '#menus.leaderboards' }\n      }\n    },\n  },\n  ...toMenu,\n};\n\nconst puzzle = {\n  initial: 'puzzle',\n  states: {\n    puzzle: {\n      on: {\n        PLAYER: { target: 'player' }\n      }\n    },\n    player: {\n      on: {\n        SELECTED: { target: 'play' }\n      }\n    },\n    play: {\n      on: {\n        COMPLETE: { target: 'complete' },\n      }\n    },\n    complete: {\n      on: {\n        NEXT: { target: 'player' },\n        SELECT: { target: 'puzzle' },\n      }\n    },\n  },\n  ...toMenu,\n};\n\nconst load = {\n  initial: 'load',\n  states: {\n    load: {\n      on: {\n        LOAD: { target: 'play' }\n      }\n    },\n    play: {\n      on: {\n        WIN: { target: 'win' },\n        LOSE: { target: 'lose' }\n      }\n    },\n    win: { type: 'final' as const },\n    lose: { type: 'final' as const },\n  },\n  ...toMenu,\n}\n\nconst training = {\n  initial: 'player',\n  states: {\n    player: {\n      entry: ['reset'],\n      on: {\n        PLAYER: { target: 'play' }\n      }\n    },\n    play: {\n      on: {\n        WIN: { target: 'win' },\n        LOSE: { target: 'lose' }\n      }\n    },\n    win: { type: 'final' as const },\n    lose: { type: 'final' as const },\n  },\n  ...toMenu,\n}\n\nconst makeArcadeContext = () => ({\n  victories: 0,\n  score: 0,\n  seed: Math.random(),\n});\nconst makeSurvivalContext = () => ({\n  victories: 0,\n  seed: Math.random(),\n});\nconst makeSingleContext = () => ({\n  seed: Math.random(),\n});\nconst makeGameContext = () => ({\n  arcadeContext: makeArcadeContext(),\n  survivalContext: makeSurvivalContext(),\n  singleContext: makeSingleContext(),\n});\n\nexport const gameMenuMachine = createMachine({\n  tsTypes: {} as import(\"./menuStateMachine.typegen\").Typegen0,\n  id: 'menus',\n  initial: 'main',\n  context: makeGameContext(),\n  states: {\n    main: {\n      on: {\n        QUICK: { target: 'quick' },\n        SINGLE: { target: 'single' },\n        TRAINING: { target: 'training' },\n        ARCADE: { target: 'arcade' },\n        SURVIVAL: { target: 'survival' },\n        LOAD: { target: 'load' },\n        // PUZZLE: { target: 'puzzle' },\n        // LEADERBOARDS: { target: 'leaderboards' },\n      }\n    },\n    quick: {\n      ...quick,\n    },\n    single: {\n      ...single,\n    },\n    arcade: {\n      ...arcade,\n    },\n    survival: {\n      ...survival,\n    },\n    load: {\n      ...load,\n    },\n    training: {\n      ...training,\n    }\n    // puzzle: {\n    //   ...puzzle,\n    // },\n    // leaderboards: {\n    //   ...toMenu,\n    // }\n  },\n}, {\n  guards: {\n    isFinal: ({ arcadeContext: { victories } }) => victories + 1 >= 7,\n  },\n  actions: {\n    bumpVictories: assign({\n      arcadeContext: ({ arcadeContext }, _event) => ({ ...arcadeContext, victories: arcadeContext.victories + 1, seed: Math.random() }),\n      survivalContext: ({ survivalContext }, _event) => ({ ...survivalContext, victories: survivalContext.victories + 1, seed: Math.random() }),\n    }),\n    bumpScore: assign({\n      arcadeContext: ({ arcadeContext }, { game }) => ({ ...arcadeContext, score: arcadeContext.score + scoreGame(game), seed: Math.random() }),\n    }),\n    reset: assign({\n      survivalContext: (c, e) => makeSurvivalContext(),\n      arcadeContext: (c, e) => makeArcadeContext(),\n      singleContext: (c, e) => makeSingleContext(),\n    }),\n  }\n});\n\nif (isDebug) {\n  interpret(gameMenuMachine, { devTools: true })\n    .onTransition((state) => console.log(state))\n    .start();\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process && process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n"],"sourceRoot":""}